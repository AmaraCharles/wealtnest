(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[54688],{353336:e=>{e.exports={fade:"fade-zUA5953i",hidden:"hidden-zUA5953i"}},598367:(e,t,i)=>{"use strict";i.d(t,{defaultVolumeOptions:()=>r});var s=i(867690),a=i(534328);const r={scaleMargins:{top:.8,bottom:0},priceScaleId:"overlay",upColor:(0,a.applyTransparency)(s.colorsPalette["color-minty-green-500"],50),downColor:(0,a.applyTransparency)(s.colorsPalette["color-ripe-red-500"],50),visible:!1,lastValueVisible:!1,priceLineVisible:!1}},293659:(e,t,i)=>{"use strict";i.d(t,{MiniChartPlotBase:()=>x,isTimePointIndex:()=>I});var s=i(259332),a=i(564848),r=i(998034),o=i(283873),n=i(650151),l=i(724377),h=i(735566),c=i(536794),d=i(444372),u=i(44049),m=i(534328),_=i(927435),p=i(68777),g=i(820028),f=i(547465),b=i(51196),S=i(707771),y=i(955722),v=i(388741),C=i(751094);const D=(0,h.getLogger)("Chart.MiniChart"),T=new b.VolumeFormatter;function w(e,t,i){return{time:e,color:i,value:t[4]}}function M(e,t){return{time:e,open:t[1],high:t[2],low:t[3],close:t[4]}}function k(e,t,i,s,a){return{time:e,topColor:s,bottomColor:a,lineColor:i,value:t[4]}}function P(e){const t=new Date(e);return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())/1e3}function I(e){return(0,c.isInteger)(e)}const F=(0,s.default)(m.resetTransparency);const O={leftLogical:-.5,rightLogical:-.5,leftPx:0,rightPx:4};class x{constructor(e,t,i,s){this._symbolChanged=new f.Delegate,this._seriesChanged=new f.Delegate,this._whitespaces=null,this._symbolResolved=new f.Delegate,this._originalScaleMode=null,this._customPriceFormatter=null,this._isDestroyed=new g.WatchedValue(!1),this._status=new g.WatchedValue(0),this._noData=new g.WatchedValue(null),this._directionBasedColor=new g.WatchedValue(null),this._dataLengthInfo=null,this._sessionId=new g.WatchedValue,this._barBuilderLoader=null,this._symbolInfo=null,this._symbol={symbol:""},this._timeFrameInvalidated=new f.Delegate,this._firstValueCache=null,this._historyUpdateReceived=!1,this._miniChart=e,this._originalSeriesOptions=t,this._currentSeriesOptions=(0,r.default)({},t),this._options=s,this._horzMargins=(0,r.default)({},O,t.horzMargins),this._series=this._createSeries(),this._originalVolumeOptions=i,this._volume=this._createVolume(),this._timeFrame=e.timeframe().spawn(),this._timeFrame.subscribe(this._updateSessionId.bind(this)),this._currentlyShownDataDescription=new C.WatchedObject({timeframe:this._timeFrame.value(),symbol:this.symbol()}),this._isLastSessionInterval=(0,p.combine)((e=>"LASTSESSION"===e.value),this._miniChart.timeframe().weakReference()),this._isLastSessionInterval.subscribe(this._updateSessionId.bind(this)),this._miniChart.timeScaleSizeChanged().subscribe(null,this._timeScaleSizeChanged.bind(this))}destroy(){this._status.unsubscribe(),this._timeFrame.destroy(),this._isDestroyed.setValue(!0),this._isLastSessionInterval.destroy(),this._barBuilderLoader?.destroy()}status(){return this._status.readonly()}noData(){return this._noData.readonly()}symbolInfo(){return this._symbolInfo}symbol(){
return this._symbol.symbol}subSession(){return this._sessionId.value()}setSymbol(e,t){(0,o.default)(e)&&(e={...this._symbol,symbol:e}),void 0!==t&&this._updateSeriesOptions(t),(0,y.compareSymbols)(this._symbol,e)||(this._symbol=e,this._updateSessionId(),this._symbolChanged.fire())}extendedSymbol(){return{...this._symbol,session:this._sessionId.value()}}updateSeriesOptions(e){let t=!1;void 0!==e.chartType&&this._originalSeriesOptions.chartType!==e.chartType?t=!0:"line"!==this._originalSeriesOptions.chartType&&"area"!==this._originalSeriesOptions.chartType||(t="postmarketLineColor"in e&&this._originalSeriesOptions.postmarketLineColor!==e.postmarketLineColor||"premarketLineColor"in e&&this._originalSeriesOptions.premarketLineColor!==e.premarketLineColor),this._updateSeriesOptions(e),t?this._onChartStyleChanged():this._series.applyOptions(e)}applyOptions(e){(0,r.default)(this._options,e)}updateHorzMargins(e){this._horzMargins=(0,r.default)(this._horzMargins,e),this.fitContent()}symbolResolved(){return this._symbolResolved}symbolChanged(){return this._symbolChanged}seriesChanged(){return this._seriesChanged}timeFrameInvalidated(){return this._timeFrameInvalidated}restoreOriginalScaleMode(){null!==this._originalScaleMode&&this._series.priceScale().applyOptions({mode:this._originalScaleMode})}switchToPercentageScaleMode(){null===this._originalScaleMode&&(this._originalScaleMode=this._series.priceScale().options().mode),this._series.priceScale().applyOptions({mode:a.PriceScaleMode.Percentage})}chartSession(){return this._miniChart.chartSession()}currentSeriesOptions(){return this._currentSeriesOptions}volumeOptions(){return this._originalVolumeOptions}series(){return this._series}volume(){return this._originalVolumeOptions.visible?this._volume:null}updateData(e,t,i){e&&this.clearSourceData();const s=this._originalSeriesOptions,a=this._buildViewData(i),r=a.series.length;if(this._historyUpdateReceived=this._historyUpdateReceived||void 0===i,0===r)return void(void 0===i&&(this._dataLengthInfo=null,this._firstValueCache=null));void 0!==i||"area"!==s.chartType&&"line"!==s.chartType||(this._firstValueCache=a.series[0].value);const o=this._historyUpdateReceived&&null===this._dataLengthInfo;if(void 0!==i&&!o){const e=this._dataLengthInfo;if(null===e)return;const t={...e};e.lastBarSession=a.lastBarSession;let i=!1;for(const t of a.series)this._series.update(t),e.lastBarTime<t.time&&(e.lastBarTime=t.time,e.realtime+=1,e.lastBarIndex+=1,i=!0);if(a.additionalSeries&&this._updateAdditionalSeriesData(a.additionalSeries),a.volume)for(const e of a.volume)this._volume.update(e);if(void 0!==this._whitespacesData&&i){const t=this._whitespacesData.findIndex((t=>t.time>e.lastBarTime));-1===t?(e.whitespaces=0,this._updateWhitespaces([])):0!==t&&(e.whitespaces-=t,this._updateWhitespaces(this._whitespacesData.slice(t)))}return i&&(void 0!==e.fixLeftEdgeUntil?(this._isMainPlot()&&e.fixLeftEdgeUntil>=e.lastBarTime&&this.fitContent(),e.lastBarTime>e.fixLeftEdgeUntil&&(e.history+=e.realtime-1,e.realtime=0,e.fixLeftEdgeUntil=void 0,
e.timeFrameInvalidated=!0,this._timeFrameInvalidated.fire())):e.timeFrameInvalidated||(e.timeFrameInvalidated=!0,this._timeFrameInvalidated.fire())),this._updateSeriesColor(a.series[a.series.length-1]),void this._dataUpdated(a,e,t)}const n=a.whitespaces,l=n?.length??0;this._dataLengthInfo={history:r,realtime:0,lastBarIndex:r-1,lastBarTime:a.series[a.series.length-1].time,whitespaces:l,fixLeftEdgeUntil:a.fixLeftEdgeUntil,timeFrameInvalidated:!1,lastBarSession:a.lastBarSession},this._updateSeriesColor(a.series[a.series.length-1]),this._series.applyOptions(this._currentSeriesOptions),this._applyPriceScaleFormatter(),t||this._beforeDataReady(),this._series.setData(a.series),a.additionalSeries&&this._setAdditionalSeriesData(a.additionalSeries),a.volume&&this._volume.setData(a.volume),this._updateWhitespaces(a.whitespaces),this._dataUpdated(a,this._dataLengthInfo)}fitContent(){if(null===this._dataLengthInfo||0===this._dataLengthInfo.history)return;const{history:e,realtime:t,whitespaces:i,lastBarTime:s,fixLeftEdgeUntil:a=0}=this._dataLengthInfo,r=this._miniChart.widget(),o=r.paneSize().width;if(0===o)return;const{leftLogical:n,rightLogical:l,leftPx:h,rightPx:c}=this._horzMargins;let d=-n-(a>=s?0:t),u=e+l+i+t;if(0!==h){d-=h/((o-h)/(u-d+1))}if(0!==c){u+=c/((o-c)/(u-d+1))}u=Math.max(d,u),r.timeScale().setVisibleLogicalRange({from:d,to:u}),r.timeScale().applyOptions({lockVisibleTimeRangeOnResize:!0})}titles(){return this._currentSeriesOptions.title?[this._currentSeriesOptions.title]:[]}deleteView(){this._series.setData([]),this._whitespaces?.setData([]),this._volume.setData([])}clearData(){this._symbolInfo=null,this._historyUpdateReceived=!1,this._dataLengthInfo=null,this._firstValueCache=null,this._customPriceFormatter=null,this._status.setValue(0),this._noData.setValue(null),this._directionBasedColor.setValue(null)}resolution(){return this._miniChart.resolution()}forcePercentageMode(){return!1}lastBarTime(){return this._dataLengthInfo?.lastBarTime}getViewData(e){return this._buildViewData(e)}getLegendData(e){const{point:t,time:s,seriesData:a}=e,r=this.series(),o=this.volume();if(void 0===t||void 0===s)return[];const l=a.get(r);if(void 0===l)return[];const h=[],c=r.priceFormatter(),u=this.currentSeriesOptions();if(!1===u.visible)return[];if("Area"===r.seriesType()||"Line"===r.seriesType()||"Baseline"===r.seriesType()||"legend"===u.tooltipType||"line"===u.tooltipType){const{value:e}=l;let t;t="area"===u.chartType?l.lineColor:l.color;const i=this.symbolInfo(),s=u.color||u.lineColor;h.push({title:u.tooltipTitle||i?.name||"",value:c.format(e),color:t||s,unit:u.showUnit?(0,_.prepareCurrencyValue)({currency_code:i?.currency_code,unit_id:i?.unit_id,value_unit_id:i?.value_unit_id,measure:i?.measure}):void 0})}else{const{open:e,high:t,low:s,close:a}=l,o=function(e,t){const i=e?t.up:t.down;return F(i)}(a>=e,(0,n.ensureDefined)(this._miniChart.upDownColors()[r.seriesType()]));[[d.t(null,{context:"in_legend"},i(746728)),c.format(e)],[d.t(null,{context:"in_legend"},i(943253)),c.format(t)],[d.t(null,{context:"in_legend"
},i(389923)),c.format(s)],[d.t(null,{context:"in_legend"},i(102696)),c.format(a)]].forEach((([e,t])=>{h.push({value:t,title:e,color:o})}))}const p=o&&a.get(o),g=this.volumeOptions();if(p){const{value:e,color:t}=p;h.push({title:g.tooltipTitle??d.t(null,{context:"in_legend"},i(971060)),value:T.format(e),color:g.ignoreColor?void 0:t&&(0,m.resetTransparency)(t),unit:g.showUnit?this.symbolInfo()?.currency_code:void 0})}return h}isDestroyed(){return this._isDestroyed.readonly()}_isMainPlot(){return!1}_onChartStyleChanged(){this._recreateSeries(),3===this._status.value()&&this.updateData(!1,!0)}_beforeDataReady(){this._currentlyShownDataDescription.setValue({timeframe:this._timeFrame.value(),symbol:this.symbol()})}_dataUpdated(e,t,i){}_onSymbolResolved(e){this._barBuilderLoader?.destroy(),this._barBuilderLoader=null,this._symbolInfo=e,this._symbolResolved.fire(this._symbolInfo)}_getViewData(e,t){const i=[],s={series:[],volume:i};let a=-1/0;const r=this._bars();if(r.isEmpty())return s;const o=this.minBarIndex(),n=this.maxBarIndex();if(null===o||null===n)return s;const l=t??(I(o)?o:r.firstIndex()),h=r.lastIndex();if(null===l||null===h)return s;let c;const{premarketLineColor:d,postmarketLineColor:u,premarketTopColor:m,premarketBottomColor:_,postmarketTopColor:p,postmarketBottomColor:g}=this._getPrePostMarketColors(),f=e=>{switch(e){case 0:return[d,m,_];case 1:return[u,p,g];default:return[]}};for(const t of r.rangeIterator(l,h)){const{value:r,index:o}=t;if(o<=S.UNPLOTTABLE_TIME_POINT_INDEX)continue;const n=this._miniChart.indexToTime(o);if(null===n){D.logWarn(`Couldn't find time for index ${o}`);continue}const l=P(1e3*n);if(l<=a)continue;a=l,c=l;const h=this._barIndexSession(o);s.lastBarSession=h,s.series.push(e(l,r,...f(h)));const d=r[4]>=r[1]?this._originalVolumeOptions.upColor:this._originalVolumeOptions.downColor;i.push({time:l,value:r[5],color:d})}if(this._isMainPlot()&&void 0===t&&void 0!==c)switch(this._timeFrame.value().value){case"1D":s.fixLeftEdgeUntil=c+86400-1;break;case"LASTSESSION":{let e=[],t=c+87840-1;const i=this._generateBarsToSessionEnd();i?.length&&null!==n&&n>h&&(e=i,t=i[i.length-1].time),s.fixLeftEdgeUntil=t,s.whitespaces=e}}return s}_buildViewData(e){switch(this._originalSeriesOptions.chartType){case"histogram":{const e=this._currentSeriesOptions;return this._getViewData(((t,i)=>function(e,t,i,s){const a=t[4];return{time:e,color:a>0?i:s,value:a}}(t,i,e.upColor,e.downColor)))}case"line":return this._getViewData(w,e);case"area":case"baseline":return this._getViewData(k,e);case"bars":case"candlesticks":return this._getViewData(M,e)}}_setAdditionalSeriesData(e){}_updateAdditionalSeriesData(e){}_barIndexSession(e){}_onSymbolError(e){D.logWarn((0,y.encodeExtendedSymbolOrGetSimpleSymbolString)(this._symbol)+" symbol resolving error: "+e),this.updateData(!0),this._status.setValue(1)}_onSymbolNotPermitted(){this._noData.setValue(1)}_onIntradaySpreadNotPermitted(){this._status.setValue(2),this._noData.setValue(4),this._isMainPlot()&&this._miniChart.showMessage(d.t(null,void 0,i(753434)))}
_onSymbolGroupNotPermitted(){this._noData.setValue(1)}_onSymbolInvalid(){this._noData.setValue(0)}_onResolutionOrExchangeNotPermittedError(){D.logError((0,y.encodeExtendedSymbolOrGetSimpleSymbolString)(this._symbol)+" resolution or exchange permission error"),this.updateData(!0),this._isMainPlot()&&this._miniChart.showMessage(d.t(null,void 0,i(284259))),setTimeout((()=>this._miniChart.updateAvailableTimeframes()),1e3)}_onDataError(){1!==this._status.value()&&this._status.setValue(2),this._noData.setValue(3)}_onDataCompleted(){this._status.setValue(3),this._noData.setValue(0===this._bars().size()?2:null),2===this._noData.value()&&this._isMainPlot()&&this._miniChart.showMessage(d.t(null,void 0,i(212938)))}async _onData(e,t){null!==this.minBarIndex()&&null!==this.maxBarIndex()&&this.updateData(!1,void 0,e)}_updateSeriesOptions(e){this._originalSeriesOptions=(0,r.default)(this._originalSeriesOptions,e),this._currentSeriesOptions=(0,r.default)(this._currentSeriesOptions,this._originalSeriesOptions),this._updateSeriesColor(),e.horzMargins&&this.updateHorzMargins(e.horzMargins)}_recreateSeries(){const e=this._miniChart.widget();e.removeSeries(this._series),e.removeSeries(this._volume),this._whitespaces&&(e.removeSeries(this._whitespaces),this._whitespaces=null),this._series=this._createSeries(),this._volume=this._createVolume(),this._seriesChanged.fire()}_initBarBuilder(e){return null===this._barBuilderLoader&&(this._barBuilderLoader=new u.AsyncResourceWrapper(Promise.all([i.e(85182),i.e(13498),i.e(7780),i.e(96003)]).then(i.bind(i,397796)).then((t=>new t.LightweightMiniChartBarBuilder(e))))),this._barBuilderLoader.promise()}_firstAndLastValuesForSeriesColor(e,t){if(null===this._firstValueCache||!this._dataLengthInfo)return null;if("line"!==e&&"area"!==e)return null;const i=this._series.dataByIndex(this._dataLengthInfo.lastBarIndex);return null!==i||t?(t=t??i,[this._firstValueCache,t.value]):null}_updateSeriesColor(e){const t=this._originalSeriesOptions,i=t.chartType,s=this._firstAndLastValuesForSeriesColor(i,e);if(null===s)return;const[a,r]=s;if("line"===i||"area"===i){const e="line"===i?r>=a:r>a;if("area"===i){const i=this._currentSeriesOptions;e?(i.lineColor=t.growingLineColor||t.lineColor,i.topColor=t.growingTopColor||t.topColor,i.bottomColor=t.growingBottomColor||t.bottomColor):(i.lineColor=t.fallingLineColor||t.lineColor,i.topColor=t.fallingTopColor||t.topColor,i.bottomColor=t.fallingBottomColor||t.bottomColor),i.lineColor||(i.lineColor=this._series.options().lineColor),this._series.applyOptions({topColor:i.topColor,bottomColor:i.bottomColor,lineColor:i.lineColor}),this._directionBasedColor.setValue(i.lineColor)}else if("line"===i){const{color:i,growingColor:s=i,fallingColor:a=i}=t,r=this._currentSeriesOptions;r.color=e?s:a,r.color||(r.color=this._series.options().color),this._series.applyOptions({color:r.color}),this._directionBasedColor.setValue(r.color)}}}_createSeries(){const e=this._miniChart.widget();let t;switch(this._currentSeriesOptions.chartType){case"line":
t=e.addSeries(a.LineSeries,this._currentSeriesOptions);break;case"histogram":t=e.addSeries(a.HistogramSeries,this._currentSeriesOptions);break;case"area":t=e.addSeries(a.AreaSeries,this._currentSeriesOptions);break;case"bars":t=e.addSeries(a.BarSeries,this._currentSeriesOptions);break;case"candlesticks":t=e.addSeries(a.CandlestickSeries,this._currentSeriesOptions);break;case"baseline":t=e.addSeries(a.BaselineSeries,this._currentSeriesOptions)}return null===this._originalScaleMode&&(this._originalScaleMode=t.priceScale().options().mode),t.priceScale().applyOptions({scaleMargins:this._currentSeriesOptions.scaleMargins}),t}_createVolume(){const e=this._miniChart.widget().addSeries(a.HistogramSeries,this._originalVolumeOptions);return e.priceScale().applyOptions({scaleMargins:this._originalVolumeOptions.scaleMargins}),e}_applyPriceScaleFormatter(){if("priceFormat"in this._originalSeriesOptions)return;const e=(0,n.ensureNotNull)(this._symbolInfo??this._miniChart.mainPlot().symbolInfo());this._currentSeriesOptions.priceFormat={type:"custom",minMove:e.minmov/e.pricescale,formatter:t=>(0,v.createSeriesFormatter)(e,"default").format(t)},this._series.applyOptions(this._currentSeriesOptions)}_updateSessionId(){this._sessionId.setValue(this._isLastSessionInterval.value()?"extended":this._symbol.session)}_updateWhitespaces(e){void 0===e||0===e.length?null!==this._whitespaces&&(this._miniChart.widget().removeSeries(this._whitespaces),this._whitespaces=null):(null===this._whitespaces&&(this._whitespaces=this._miniChart.widget().addSeries(a.LineSeries)),this._whitespacesData=null===this._whitespaces?void 0:e,this._whitespaces.setData(e))}_generateBarsToSessionEnd(){const e=this.symbolInfo(),t=this._bars().lastIndex(),i=this.maxBarIndex();if(e&&t&&i&&this._isLastSessionInterval.value()){let e=this._miniChart.indexToTime(t);if(null===e)return;const s=[];for(let a=t+1;a<=i;a+=1){const t=this._miniChart.indexToTime(a)??e+60;s.push({time:P(1e3*t)}),e=t}return s}}_getPrePostMarketColors(){if(!this._isMainPlot())return{};let e,t,i,s;const a=this._originalSeriesOptions.premarketLineColor,r=this._originalSeriesOptions.postmarketLineColor;if("area"===this._originalSeriesOptions.chartType&&a&&r){const o=this._currentSeriesOptions,n=o.growingTopColor||o.fallingTopColor||o.topColor;if(void 0!==n){const t=(0,l.tryParseRgba)(n);if(null!==t){const s=t[3];e=(0,m.applyAlpha)(a,s),i=(0,m.applyAlpha)(r,s)}}const h=o.growingBottomColor||o.fallingBottomColor||o.bottomColor;if(void 0!==h){const e=(0,l.tryParseRgba)(h);if(null!==e){const i=e[3];t=(0,m.applyAlpha)(a,i),s=(0,m.applyAlpha)(r,i)}}}return{premarketLineColor:a,postmarketLineColor:r,premarketTopColor:e,postmarketTopColor:i,premarketBottomColor:t,postmarketBottomColor:s}}_timeScaleSizeChanged(){this._isMainPlot()&&Promise.resolve().then((()=>this.fitContent()))}}},195317:(e,t,i)=>{"use strict";i.d(t,{MiniChartPlot:()=>h});var s=i(650151),a=i(132565),r=i(584785),o=i(535422),n=i(293659),l=i(306543);class h extends n.MiniChartPlotBase{constructor(e,t,i,s,a,r){super(e,t,i,a),
this._seriesDataSource=null,this._cachedData=null,this._minBarIndex=null,this._maxBarIndex=null,this._studyPlots=s,this._options=a,r&&this._loadCache(r)}destroy(){this._seriesDataSource?.destroy(),super.destroy()}reloadCache(e){this._cache=e,e?this._loadCache(e):(this._minBarIndex=null,this._maxBarIndex=null,this._cachedData=null,this._onData().then((()=>{this.fitContent()})))}requestData(){const e=this._getSeriesDataSource();this._status.setValue(0),this._noData.setValue(null),e.modifySeries(this.extendedSymbol(),(0,l.getServerInterval)(this.resolution()),this._miniChart.timeframe().value()),e.isStarted()||e.start()}clearSourceData(){this._seriesDataSource?.clearData(),this._studyPlots().forEach((e=>e.clearSourceData()))}moveSourceData(e){this._seriesDataSource?.moveData(e)}onTickmarksAdded(e,t){const i=this.maxBarIndex();this._isLastSessionInterval.value()&&null!==i&&i>=e&&i<=t&&(this.updateData(!1,!0),this.fitContent())}disconnect(){this._seriesDataSource?.stop()}isConnected(){return Boolean(this._seriesDataSource?.isStarted())}clearData(){if(super.clearData(),this._minBarIndex=null,this._maxBarIndex=null,null!==this._seriesDataSource&&(this._seriesDataSource.stop(),this.clearSourceData()),this._cache){const{minBarIndex:e,maxBarIndex:t,symbolInfo:i}=this._cache;this._minBarIndex=e,this._maxBarIndex=t,i&&(this._symbolInfo=i,this._initBarBuilder(i).then((()=>{this._isDestroyed.value()||this._onData().then((()=>{this.fitContent()}))})))}}seriesDataSource(){return this._getSeriesDataSource()}firstBar(){return(0,n.isTimePointIndex)(this._minBarIndex)?this._bars().search(this._minBarIndex):this._bars().first()}lastBar(){return(0,n.isTimePointIndex)(this._maxBarIndex)?this._bars().search(this._maxBarIndex,r.PlotRowSearchMode.NearestLeft):this._bars().last()}minBarIndex(){return this._minBarIndex}maxBarIndex(){return this._maxBarIndex}cacheData(){const e=this._seriesDataSource?.data()?.clone(),t=this._symbolInfo,i=this._minBarIndex,s=this._maxBarIndex;return e&&null!==t&&null!==i&&null!==s?{data:e,symbolInfo:t,minBarIndex:i,maxBarIndex:s}:null}_isMainPlot(){return!0}_dataUpdated(e,t,i){if(super._dataUpdated(e,t,i),!this._isLastSessionInterval.value()||!this._miniChart.supportRealtimeUpdates()||!i)return;const s=i.lastBarSession;0!==s&&1!==s||2!==t.lastBarSession||Promise.resolve().then((()=>{this._miniChart.setTimeframe(this._miniChart.timeframe().value(),!1,!0)}))}_onChartStyleChanged(){(0,s.assert)(0===this._studyPlots().length,"Dynamic style change is not supported if there are additional plots"),super._onChartStyleChanged()}_beforeDataReady(){super._beforeDataReady(),this._studyPlots().forEach((e=>e.deleteView()))}_getSeriesDataSource(){if(null===this._seriesDataSource){const e=this._seriesDataSource=new o.SeriesDataSource(this.chartSession(),"s"),t=e.dataEvents();t.symbolResolved().subscribe(this,this._onSymbolResolved),t.symbolNotPermitted().subscribe(this,this._onSymbolNotPermitted),t.symbolGroupNotPermitted().subscribe(this,this._onSymbolGroupNotPermitted),
t.intradaySpreadNotPermitted().subscribe(this,this._onIntradaySpreadNotPermitted),t.symbolInvalid().subscribe(this,this._onSymbolInvalid),t.symbolError().subscribe(this,this._onSymbolError),t.intradayExchangeNotPermitted().subscribe(this,this._onResolutionOrExchangeNotPermittedError),t.customIntervalNotPermitted().subscribe(this,this._onResolutionOrExchangeNotPermittedError),t.completed().subscribe(this,this._onDataCompleted),t.seriesError().subscribe(this,this._onDataError),t.seriesTimeFrame().subscribe(this,this._onTimeFrame),t.dataUpdated().subscribe(this,this._onDataInternal),t.created().subscribe(null,(()=>performance.mark("RFD",{detail:"Request first data"})),!0),t.created().subscribe(null,(()=>e.setFutureTickmarksMode("full_single_session"))),t.dataUpdated().subscribe(null,(()=>{performance.mark("FDR",{detail:"First data response"}),performance.measure("Response idle","RFD","FDR")}),!0)}return this._seriesDataSource}_bars(){return this._cachedData?this._cachedData.seriesData.bars():this._seriesDataSource?.data().bars()??new a.PlotList}_onTimeFrame(e,t){this._cachedData||(this._minBarIndex=e,this._maxBarIndex=t),this.updateData(!1),this._studyPlots().forEach((e=>e.updateData(!1,!0)))}_onDataCompleted(){this._cachedData&&(this._cachedData=null),super._onDataCompleted(),this.updateData(!1,!0),this.fitContent()}_onDataInternal(e,t,i){this._onData(t?void 0:i?.index)}async _loadCache(e){const{data:t,symbolInfo:i,minBarIndex:s,maxBarIndex:a}=e;this._minBarIndex=s,this._maxBarIndex=a,this._cachedData={symbol:this.extendedSymbol(),resolution:this.resolution(),timeFrame:this._miniChart.timeframe().value(),seriesData:t},this._symbolInfo=i;const r=await this._initBarBuilder(i);!this._isDestroyed.value()&&this._symbolInfo&&(this._symbolInfo!==i&&r.update(this._symbolInfo),await this._onData(),this._status.setValue(3),this.fitContent())}}},254688:(e,t,i)=>{"use strict";i.d(t,{LightweightMiniChart:()=>N});var s=i(564848),a=i(998034),r=i(650151),o=i(790188),n=i(735566),l=i(444372),h=i(423623),c=i(981191),d=i(477786),u=i(941285),m=i(985841),_=i(500874),p=i(67231),g=i(598367),f=i(195317);const b=(0,s.defaultHorzScaleBehavior)();class S extends b{constructor(){super(...arguments),this._lastHash=""}shouldResetTickmarkLabels(e){const t=this.calculateItemsHash(e),i=t!==this._lastHash;return this._lastHash=t,i}calculateItemsHash(e){return e.reduce(((e,t)=>e+t.index),"")}}var y=i(547465),v=i(862150),C=i(820028),D=i(751094),T=i(353336);const w=(0,n.getLogger)("Chart.MiniChart"),M={value:"12M",type:"period-back"},k={top:.01,bottom:.01},P={chartType:"area",lineWidth:2,priceLineVisible:!1,crosshairMarkerVisible:!1,lastValueVisible:!1,scaleMargins:k},I={lineWidth:2,priceLineVisible:!1,crosshairMarkerVisible:!1,lastValueVisible:!1,scaleMargins:k},F={chartType:"baseline"},O={priceLineVisible:!1,lastValueVisible:!1,scaleMargins:k},x={priceLineVisible:!1,lastValueVisible:!1,scaleMargins:k},L={scaleMargins:k},V={visible:!1,color:o.colorsPalette["color-tv-blue-500"],lineWidth:1,length:9,lastValueVisible:!1,priceLineVisible:!1},B={spinner:{
visible:!1,width:4,color:o.colorsPalette["color-brand"]},fade:{visible:!1},clearDataOnSymbolChange:!0,clearDataOnTimeframeChange:!0},R={onFirstData:null,description:"",showDescription:!0,timeframe:{visible:!1,value:M.value},chartOptions:{minWidth:0,minHeight:0,chart:{grid:{horzLines:{color:"rgba(120, 123, 134, 0.1)",visible:!1},vertLines:{color:"#ffffff",visible:!1}},crosshair:{horzLine:{visible:!1,style:3,width:1,labelVisible:!1,labelBackgroundColor:"#0f0f0f"},vertLine:{visible:!1,style:3,width:1,labelVisible:!1,labelBackgroundColor:"#0f0f0f"}},layout:{fontFamily:"Trebuchet MS",fontSize:10,textColor:"#83888D",background:{type:s.ColorType.Solid,color:"transparent"},attributionLogo:!1},rightPriceScale:{visible:!0,borderVisible:!1,entireTextOnly:!0,mode:s.PriceScaleMode.Normal},leftPriceScale:{visible:!1,borderVisible:!1,entireTextOnly:!0,mode:s.PriceScaleMode.Normal},timeScale:{borderVisible:!1,timeVisible:!0,secondsVisible:!1,lockVisibleTimeRangeOnResize:!0},handleScale:!1,handleScroll:!1},series:P,volume:g.defaultVolumeOptions,ma:V,loading:B}},E={"1y":{value:"12M",type:"period-back"},"5y":{value:"60M",type:"period-back"},max:{value:"ALL",type:"period-back"}};function z(e,t,i,a,r,o){return!!e.dayAndTimeTickMarkFixEnabled&&(a===s.TickMarkType.Time?function(e){return e.value.endsWith("M")||e.value.endsWith("Y")||["YTD","ALL"].includes(e.value)}(t):!(!r||!o||a<=o)&&(a===s.TickMarkType.DayOfMonth&&(i.getMonth()!==r.getMonth()||i.getFullYear()!==r.getFullYear())))}const U=(()=>{let e=null,t=null,i=null;return(a,r,o,n,l,h)=>{const c={},d=new Date(1e3*n);i!==o.value&&(e=null,t=null,i=o.value);let u=!1;if(r){u=(r.suppressFn??z)(r,o,d,l,e,t)}if(e=d,t=l,u)return"";switch(l){case s.TickMarkType.Year:r?.hideYearsTickMarks?c.month="short":c.year="numeric";break;case s.TickMarkType.Month:c.month="short";break;case s.TickMarkType.DayOfMonth:c.day="numeric";break;case s.TickMarkType.Time:c.hour12="12-hours"===a,c.hour="2-digit",c.minute="2-digit";break;case s.TickMarkType.TimeWithSeconds:c.hour12="12-hours"===a,c.hour="2-digit",c.minute="2-digit",c.second="2-digit"}const m=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds());return e=d,t=l,m.toLocaleString(h,c)}})();window.lightweightMiniChartInstances=window.lightweightMiniChartInstances||{};const W=window.lightweightMiniChartInstances;let A=0;const H={acquire:()=>(0,v.ownership)(new h.ChartSession(window.ChartApiInstance,!0))};class N{constructor(e,t,i,r){this._isDestroyed=!1,this._studyPlots=[],this._elTimeframe=null,this._timeframeView=null,this._tickmarks=new Map,this._cachedTickmarks=new Map,this._chartSession=null,this._chartSessionConnected=null,this._connectCallback=null,this._connected=!1,this._loadErrorTimeout=null,this._isLoading=!1,this._spinner=null,this._crosshairMoveHandlers=new Map,this._atomicUpdateIsGoing=!1,this._seriesUpDownColors={},this._isDWMResolution=!1,this._updateTimerId=null,this._width=new C.WatchedValue(0),this._height=new C.WatchedValue(0),
this._status=new C.WatchedValue("loading"),this._timeScaleSizeChanged=new y.Delegate,this._onPlotStatusChanged=()=>{const e=this._mainPlot.status().value(),t=this._studyPlots.every((e=>0!==e.status().value()));switch(e){case 3:t&&this._onPlotsDataReady();break;case 2:this._onMainPlotDataError();break;case 1:this._onMainPlotSymbolResolvingError()}if(this._options.chartOptions.loading.fade.visible)switch(this._cachedTickmarks.size>0||e){case 0:this._innerContainer.classList.add(T.fade);break;case 2:case 1:case 3:case!0:this._innerContainer.classList.remove(T.fade)}this._updateStatus()},this._timeFrameOptions=i?.timeframe?.options??(0,c.getMiniTimeFrameOptions)(),this._options=(0,a.default)({},R,i),this._chartSessionProvider=r??H,this._container=t,this._innerContainer=t.ownerDocument.createElement("div"),this._innerContainer.style.width="100%",this._innerContainer.style.height="100%",this._innerContainer.style.minHeight="inherit",this._innerContainer.style.minWidth="inherit",t.appendChild(this._innerContainer),this._widget=(0,s.createChartEx)(this._innerContainer,new S,{...this._options.chartOptions?.chart,autoSize:!0});const o=this._widget.panes()[0];this._textWatermark=(0,s.createTextWatermark)(o,{visible:!1}),this._timeframe=new D.WatchedObject({type:"period-back",value:this._options.timeframe.value}),this._mainPlot=this._createMainPlot(e),this.setTimeframe(this._timeframe.value(),!0);const n=this._options.cache?.loadData(this._timeframe.value().value);n?(this._cachedTickmarks=n.tickmarks,this._tickmarks=new Map(this._cachedTickmarks),this._createTooltipDateFormatter()):this.connect(),this._parentResizeObserver=new ResizeObserver((e=>{this._mainPlot.fitContent();for(const t of e)if(t.contentBoxSize){const e=t.contentBoxSize[0];this._width.setValue(e.inlineSize),this._height.setValue(e.blockSize)}})),this._parentResizeObserver.observe(t);const l=t.getBoundingClientRect();this._width.setValue(l.width),this._height.setValue(l.height),this._createLegend(),this._updateSeriesUpDownColors(),this._boundTimeScaleSizeChangedHandler=this._timeScaleSizeChangedHandler.bind(this),this._widget.timeScale().subscribeSizeChange(this._boundTimeScaleSizeChangedHandler),A+=1,this._innerContainer.dataset.lightweightMiniChartId=`${A}`,W[this._innerContainer.dataset.lightweightMiniChartId]=this}container(){return this._container}innerContainer(){return this._innerContainer}getChartContainer(){return this._container.getElementsByTagName("div").item(0)?.getElementsByTagName("table").item(0)?.getElementsByTagName("tr").item(0)?.getElementsByTagName("td").item(1)?.getElementsByTagName("div").item(0)??null}width(){return this._width.readonly()}height(){return this._height.readonly()}status(){return this._status.readonly()}seriesDataSource(){return this._mainPlot.seriesDataSource()}supportRealtimeUpdates(){return Boolean(this._options.doNotDisconnectOnDataReady)}connect(e){(0,r.assert)(!this._options.cache?.loadData(this._timeframe.value().value),"Chart can not to connect if there is an existing cache data"),
"function"==typeof e&&(this._connectCallback=e),this._clearReconnectionTimeout(),this.connected()||(this._showLoading(),this._mainPlot.clearData(),this._studyPlots.forEach((e=>e.clearData())),this._chartSession||(this._chartSession=this._chartSessionProvider.acquire(),this._chartSession.criticalError().subscribe(this,this._onChartSessionCriticalError),this._chartSessionConnected=this._chartSession.isConnected().spawn(),this._chartSessionConnected.subscribe(this._onChartSessionIsConnectedChanged.bind(this),{callWithLast:!0})),this._chartSession.connect(this._onData.bind(this)),this._chartSession.isConnected().value()&&this._requestData(),this._clearLoadErrorTimeout(),this._loadErrorTimeout=setTimeout((()=>{this.showMessage(l.t(null,void 0,i(653273))),"function"==typeof this._options.onFirstData&&(this._options.onFirstData(),this._options.onFirstData=null)}),15e3))}disconnect(){this._studyPlots.forEach((e=>e.disconnect())),this._mainPlot.disconnect(),this._chartSession?.disconnect(),this._connected=!1,this._clearLoadErrorTimeout()}connected(){return Boolean(this._connected&&this._chartSession&&this._chartSession.isConnected().value())}setTimeframe(e,t,i){const s=this._timeframe.value();let a=e;const r=E[a.value];void 0!==r&&(a=r);const o=this._timeframeIsAvailable(a)?a:M;this._options.timeframe.currentTimeframeCallback&&this._options.timeframe.currentTimeframeCallback(o.value),this._timeframe.setValue(o),this._activeRange=this._timeframe.value().value,this._timeframeView&&this._options.timeframe.visible&&this._timeframeView.update({activeRange:this._activeRange});const n=this._options.cache?.loadData(this._timeframe.value().value);if(n)return this._cachedTickmarks=n.tickmarks,this._tickmarks=new Map(this._cachedTickmarks),this._createTooltipDateFormatter(),void this._mainPlot.reloadCache(n.mainPlot);this._cachedTickmarks.size&&(this._cachedTickmarks=new Map,this._tickmarks=new Map,this._mainPlot.reloadCache(),this._mainPlot.clearData()),(!t&&s!==this._timeframe.value()||i)&&this._requestDataOnTimeframeChange()}chartSession(){return(0,r.ensureNotNull)(this._chartSession)}widget(){return this._widget}timeframe(){return this._timeframe.readonly()}setTimeFrameOptions(e,t){if(e===this._timeFrameOptions)return;const i=this.resolution();this._timeFrameOptions=e,t?this.setTimeframe(t):this.resolution()!==i&&this._requestDataOnTimeframeChange(),this._initTimeframesRenderer()}timeFrameOptions(){return this._timeFrameOptions}resolution(){const e=this._timeFrameOptions.find((e=>e.value.value===this.timeframe().value().value));return(0,r.ensureDefined)(e?.targetResolution)}changeSymbol(e,t){void 0!==t&&this._updateSeriesOptions(t),this._options.chartOptions.loading.clearDataOnSymbolChange&&(this._mainPlot.clearData(),this._mainPlot.deleteView(),this._studyPlots.forEach((e=>e.clearData())),this._studyPlots.forEach((e=>e.deleteView()))),this._mainPlot.setSymbol(e,this._options.chartOptions.series),this._mainPlot.requestData(),this._studyPlots.forEach((e=>e.requestData())),this.connect()}updateSeriesOptions(e){
this._atomicUpdateIsGoing=!0,this._updateSeriesOptions(e),this._updateSeriesUpDownColors(),this._mainPlot.updateSeriesOptions(e),this._atomicUpdateIsGoing=!1}getSeriesOptions(){return this._mainPlot.currentSeriesOptions()}updateAdditionalSeriesOptions(e,t){this._studyPlots[t].updateSeriesOptions(e)}showMessage(e){this._hideLoading(),this._mainPlot.deleteView(),this._studyPlots.forEach((e=>e.deleteView())),this._textWatermark.applyOptions?.({visible:!0,lines:[{color:"#83888D",text:e,fontSize:12}]})}hideMessage(){this._textWatermark.applyOptions?.({visible:!1,lines:[]})}from(){const e=this._timeFrameOptions.find((e=>e.value.value===this.timeframe().value().value));return[e?.from]}enable(e){this.connect(e)}disable(){this.disconnect()}destroy(){this._boundTimeScaleSizeChangedHandler&&(this._widget.timeScale().unsubscribeSizeChange(this._boundTimeScaleSizeChangedHandler),this._boundTimeScaleSizeChangedHandler=void 0),this._parentResizeObserver.disconnect(),this.disconnect(),this._widget.remove(),this._mainPlot.symbolResolved().unsubscribeAll(null),this._mainPlot.timeFrameInvalidated().unsubscribeAll(this),this._mainPlot.destroy(),this._studyPlots.forEach((e=>e.destroy())),this._timeframeView?.destroy(),this._chartSessionConnected?.destroy(),this._chartSession?.criticalError().unsubscribeAll(this),this._chartSession?.release(),delete W[this._innerContainer.dataset.lightweightMiniChartId],this._innerContainer.remove(),this._isDestroyed=!0}updateAvailableTimeframes(){this._mainPlot.symbolInfo()?(this._timeframeView&&this._options.timeframe.visible&&this._timeframeView.update({ranges:this._getAvailableTimeFrames()}),this.setTimeframe(this._timeframe.value())):w.logWarn("Updating available resolutions without full symbol info")}mainPlot(){return this._mainPlot}hasStudyPlots(){return this._studyPlots.length>0}studyPlots(){return this._studyPlots}addStudyPlot(e){return this._studyPlots.push(e),e.status().subscribe(this._onPlotStatusChanged),this.connected()?e.requestData():this.connect(),e.forcePercentageMode()&&this._mainPlot.switchToPercentageScaleMode(),this._updateStatus(),{noData:e.noData(),status:e.status(),remove:()=>{this._removeStudyPlot(e)},symbol:()=>e.symbol(),extendedSymbol:()=>e.extendedSymbol(),options:()=>e.currentSeriesOptions()}}indexToTime(e){const t=this._tickmarks.size?this._tickmarks:this._cachedTickmarks;return t.get(e)?.time??null}subscribeCrosshairMove(e){const t=t=>{this._atomicUpdateIsGoing||e(t)};this._crosshairMoveHandlers.set(e,t),this._widget.subscribeCrosshairMove(t)}unsubscribeCrosshairMove(e){const t=this._crosshairMoveHandlers.get(e);t&&(this._crosshairMoveHandlers.delete(e),this._widget.unsubscribeCrosshairMove(t))}upDownColors(){return this._seriesUpDownColors}dateTimeFormatter(){return this._dateTimeFormatter}isDWMResolution(){return this._isDWMResolution}updateChartRightMarginAccordingToTitles(){const e=this.mainPlot().currentSeriesOptions().horzMargins?.rightPx;if(e)this.mainPlot().updateHorzMargins({rightPx:e});else{const e=[this.mainPlot(),...this._studyPlots];let t=0
;for(const i of e)for(const e of i.titles())t=Math.max(t,e.length);this.mainPlot().updateHorzMargins({rightPx:12*t})}this.mainPlot().fitContent()}activeRange(){return this._activeRange}timeScaleSizeChanged(){return this._timeScaleSizeChanged}_getChartPlotClass(){return f.MiniChartPlot}_createMainPlot(e){const t=new(this._getChartPlotClass())(this,this._options.chartOptions.series,this._options.chartOptions.volume,(()=>this._studyPlots),this._options.mainPlotOptions,this._options.cache?.loadData(this._timeframe.value().value)?.mainPlot);return t.setSymbol(e),t.symbolResolved().subscribe(this,this._onSymbolResolved),t.timeFrameInvalidated().subscribe(this,this._onTimeFrameInvalidated),t.status().subscribe(this._onPlotStatusChanged),t}_onPlotsDataReady(){"function"==typeof this._options.onFirstData&&(this._options.onFirstData(),this._options.onFirstData=null),this._hideLoading(),this.hideMessage(),this._clearLoadErrorTimeout(),this._options.doNotDisconnectOnDataReady||this.disconnect(),this._createReconnectionTimeout(),this._saveCache()}_removeStudyPlot(e){const t=this._studyPlots.indexOf(e);(0,r.assert)(-1!==t),this._studyPlots.splice(t,1),e.status().unsubscribe(this._onPlotStatusChanged),e.deleteView(),e.clearData(),e.destroy(),this._studyPlots.every((e=>!e.forcePercentageMode()))&&this._mainPlot.restoreOriginalScaleMode(),this._updateStatus()}_updateSeriesUpDownColors(){const e=this._options.chartOptions.series;switch(e.chartType){case"candlesticks":this._seriesUpDownColors.Candlestick={up:e.borderUpColor??e.upColor,down:e.borderDownColor??e.downColor};break;case"bars":this._seriesUpDownColors.Bar={up:e.upColor,down:e.downColor};break;case"histogram":this._seriesUpDownColors.Histogram={up:e.upColor||e.color,down:e.downColor||e.color}}}_updateSeriesOptions(e){this._options.chartOptions.series=function(e){let t;switch(e.chartType??"area"){case"bars":t=O;break;case"candlesticks":t=x;break;case"area":t=P;break;case"line":t=I;break;case"histogram":t=L;break;case"baseline":t=F}return(0,a.default)({},t,e)}(e)}_saveCache(){const{cache:e}=this._options;if(!e)return;const t=this._prepareCacheData();t&&(e.saveData(this._timeframe.value().value,t),this._cachedTickmarks=t.tickmarks)}_prepareCacheData(){if(!this._tickmarks.size)return null;const e=this._mainPlot.cacheData();return e?{mainPlot:e,tickmarks:new Map(this._tickmarks)}:null}_onMainPlotDataError(){this._hideLoading(),this.showMessage(l.t(null,void 0,i(57335))),this._clearLoadErrorTimeout(),this.disconnect()}_onMainPlotSymbolResolvingError(){this._hideLoading(),this.showMessage(l.t(null,void 0,i(653273))),this._clearLoadErrorTimeout(),this.disconnect()}_createReconnectionTimeout(){if(this._options.doNotDisconnectOnDataReady)return;const e=this._options.updateTimeout;void 0!==e&&e>0&&(this._updateTimerId=setTimeout((()=>{this._updateTimerId=null,this.connected()?this._requestData():this.connect()}),e))}_clearReconnectionTimeout(){null!==this._updateTimerId&&(clearInterval(this._updateTimerId),this._updateTimerId=null)}_clearLoadErrorTimeout(){
this._loadErrorTimeout&&(clearTimeout(this._loadErrorTimeout),this._loadErrorTimeout=null)}_initTimeframesRenderer(){if(!this._options.timeframe.visible)return;{const e=this._timeFrameOptions.length<2;if(this._timeframeView?.update({hidden:e}),(this._elTimeframe??this._options.timeframe.container)?.classList.toggle(T.hidden,e),e)return}if(this._elTimeframe)return;this._options.timeframe.container?this._elTimeframe=this._options.timeframe.container:(this._elTimeframe=document.createElement("div"),this._container.appendChild(this._elTimeframe));const e=(e,t)=>{const i=this._timeFrameOptions.length<2,s=(0,r.ensureNotNull)(this._elTimeframe);s.classList.toggle(T.hidden,i),this._timeframeView=new e.TimeFrameViewRenderer(s,{name:"minichart_timeframe",activeRange:this._activeRange,ranges:this._getAvailableTimeFrames(),onSelectRange:e=>{this.setTimeframe({value:e,type:"period-back"})},size:this._options.timeframe.size,hidden:i,theme:t})};Promise.all([i.e(61171),i.e(72104),i.e(82321),i.e(31891)]).then(i.bind(i,957001)).then((t=>{(this._options.timeframe.getTheme||(()=>Promise.resolve(void 0)))().then((i=>e(t,i)))}))}_createLegend(){this._options.legend&&this._options.legend.visible&&Promise.all([i.e(80735),i.e(15169),i.e(84986),i.e(82321),i.e(42980)]).then(i.bind(i,718520)).then((e=>e.createLegend(this._options.legend.container,this._options.legend.items)))}_getAvailableTimeFrames(){const e=[];for(const t of this._timeFrameOptions)this._timeframeIsAvailable(t.value)&&e.push({value:t.value.value,text:t.text,description:t.description});return e}_timeframeIsAvailable(e){const t=this._timeFrameOptions.find((t=>t.value.value===e.value));if(!t)return!1;const i=this.mainPlot().symbolInfo();if(!i||i.pro_name!==this._mainPlot.symbol())return!0;if(i.has_intraday)return!0;return!d.Interval.parse(t.targetResolution).isIntraday()}_onChartSessionIsConnectedChanged(e){e!==this._connected&&(e?(this._connected=!0,"function"==typeof this._connectCallback&&this._connectCallback(),this._chartSession?.switchTimezone("Etc/UTC"),this._requestData()):(this._connected=!1,this._mainPlot.disconnect(),this._studyPlots.forEach((e=>e.disconnect()))))}_onChartSessionCriticalError(){this._connected=!1}_createTooltipDateFormatter(){const e=d.Interval.parse(this.resolution());let t;this._isDWMResolution=e.isDWM(),this._widget.timeScale().applyOptions({timeVisible:!this._isDWMResolution,secondsVisible:e.isSeconds()});const{dateFormat:i="dd MMM 'yy",timeHoursFormat:s="24-hours",suppressTickMarks:a}=this._options.chartOptions;t=this._isDWMResolution?new m.DateFormatter(i):new _.DateTimeFormatter({dateFormat:i,timeFormat:(0,p.getTimeFormatForInterval)(e,s)}),this._dateTimeFormatter=t,this._widget.applyOptions({localization:{timeFormatter:e=>t.format(new Date(1e3*e))},timeScale:{tickMarkFormatter:U.bind(null,s,a,this._timeframe.value())}}),this._widget.applyOptions({timeScale:{timeVisible:!d.Interval.parse(this._mainPlot.resolution()).isDWM()}})}_requestData(){this._createTooltipDateFormatter(),this._clearReconnectionTimeout(),this._mainPlot.requestData(),
this._studyPlots.forEach((e=>e.requestData()))}_onData(e){if(this._mainPlot.isConnected())switch(e.method){case"timescale_update":{const t=e.params;if(t.clear){this._tickmarks.clear(),this._mainPlot.clearSourceData();for(const e of this._studyPlots)e.clearSourceData()}if(t.index_diff.length>0){this._mainPlot.moveSourceData(t.index_diff);for(const e of this._studyPlots)e.moveSourceData(t.index_diff)}const i=t.marks;let s=1/0,a=-1/0;for(const e of i)this._tickmarks.has(e.index)||(s=Math.min(s,e.index),a=Math.max(a,e.index)),this._tickmarks.set(e.index,e);Number.isFinite(s)&&this._mainPlot.onTickmarksAdded(s,a),this._saveCache();break}}}_onSymbolResolved(){this.updateAvailableTimeframes(),this._initTimeframesRenderer()}_onTimeFrameInvalidated(){this._activeRange=void 0,this._timeframeView?.update({activeRange:void 0})}_showLoading(){if(this._isLoading)return;this.hideMessage();const e=this._options.chartOptions.loading;e.spinner.visible&&(null===this._spinner&&(this._spinner=new u.Spinner("mini").setStyle({color:e.spinner.color,width:e.spinner.width.toString(),zIndex:"10"})),this._spinner.spin(this._innerContainer)),e.fade.visible&&this._innerContainer.classList.add(T.fade),this._isLoading=!0}_hideLoading(){this._isLoading&&(this._spinner&&this._spinner.stop(),this._isLoading=!1)}_requestDataOnTimeframeChange(){this._options.chartOptions.loading.clearDataOnTimeframeChange&&(this.mainPlot().clearData(),this.mainPlot().deleteView(),this._studyPlots.forEach((e=>e.clearData())),this._studyPlots.forEach((e=>e.deleteView()))),this.connected()?this._requestData():this.connect()}_updateStatus(){const e=[this._mainPlot.status().value(),...this._studyPlots.map((e=>e.status().value()))],t=e.every((e=>0!==e))?3===e[0]?"ready":"error":"loading";this._status.setValue(t)}_timeScaleSizeChangedHandler(e,t){this._timeScaleSizeChanged.fire(e,t)}}},751094:(e,t,i)=>{"use strict";i.d(t,{WatchedObject:()=>s.WatchedObject});var s=i(158942)},500874:(e,t,i)=>{"use strict";i.d(t,{DateTimeFormatter:()=>o});var s=i(74752),a=i(985841);const r={dateFormat:"yyyy-MM-dd",withWeekday:!1,timeFormat:s.hourMinuteSecondFormat,dateTimeSeparator:" "};class o{constructor(e={}){const t=Object.assign({},r,e);this._dateFormatter=new a.DateFormatter(t.dateFormat,t.withWeekday),this._timeFormatter=new s.TimeFormatter(t.timeFormat),this._separator=t.dateTimeSeparator}format(e,t){const i=t?.dateTimeSeparator??this._separator;return`${this._dateFormatter.format(e)}${i}${this._timeFormatter.format(e)}`}formatLocal(e,t){const i=t?.dateTimeSeparator??this._separator;return`${this._dateFormatter.formatLocal(e)}${i}${this._timeFormatter.formatLocal(e)}`}}},253674:(e,t,i)=>{"use strict";i.d(t,{hourMinuteFormat:()=>o,hourMinuteNonZeroSecondFormat:()=>a,hourMinuteSecondFormat:()=>s,hourMinuteSecondMillisecFormat:()=>r,twelveHourMinuteFormat:()=>h,twelveHourMinuteNonZeroSecondFormat:()=>l,twelveHourMinuteSecondFormat:()=>n});const s="%h:%m:%s",a="%h:%m:%s+",r="%h:%m:%s.%ss+",o="%h:%m",n="%h:%m:%s %ampm",l="%h:%m:%s+ %ampm",h="%h:%m %ampm"},74752:(e,t,i)=>{"use strict";i.d(t,{
TimeFormatter:()=>o,hourMinuteFormat:()=>r.hourMinuteFormat,hourMinuteNonZeroSecondFormat:()=>r.hourMinuteNonZeroSecondFormat,hourMinuteSecondFormat:()=>r.hourMinuteSecondFormat,hourMinuteSecondMillisecFormat:()=>r.hourMinuteSecondMillisecFormat,twelveHourMinuteFormat:()=>r.twelveHourMinuteFormat,twelveHourMinuteNonZeroSecondFormat:()=>r.twelveHourMinuteNonZeroSecondFormat,twelveHourMinuteSecondFormat:()=>r.twelveHourMinuteSecondFormat});var s=i(191914),a=i(909456),r=i(253674);class o{constructor(e){this._isTwelveHoursFormat=!1,this._valuesAndDelimeters=[];const t=e||r.hourMinuteSecondFormat,i=new RegExp("%h|%m|%s\\+|%ss\\+|%ss|%ampm|%s","g");let s=i.exec(t),a=0;for(;null!==s;){const e=s[0];"%ampm"===e&&(this._isTwelveHoursFormat=!0);const r=t.substring(a,s.index);""!==r&&this._valuesAndDelimeters.push(r),this._valuesAndDelimeters.push(e),a=s.index+e.length,s=i.exec(t)}}format(e){return s.customFormatters.timeFormatter?s.customFormatters.timeFormatter.format(e):this._formatTime(e,!1)}formatLocal(e){return s.customFormatters.timeFormatter?s.customFormatters.timeFormatter.formatLocal?s.customFormatters.timeFormatter.formatLocal(e):s.customFormatters.timeFormatter.format(e):this._formatTime(e,!0)}_formatTime(e,t){let i=t?e.getHours():e.getUTCHours();const s=t?e.getMinutes():e.getUTCMinutes(),r=t?e.getSeconds():e.getUTCSeconds(),o=t?e.getMilliseconds():e.getUTCMilliseconds();let n="";this._isTwelveHoursFormat&&(n=i>=12?"PM":"AM",i%=12,i=i||12);let l="",h=!1;for(let e=this._valuesAndDelimeters.length-1;e>=0;e--){const t=this._valuesAndDelimeters[e];let c;switch(t){case"%h":c=(0,a.numberToStringWithLeadingZero)(i,2);break;case"%m":c=(0,a.numberToStringWithLeadingZero)(s,2);break;case"%s+":0!==r?c=(0,a.numberToStringWithLeadingZero)(r,2):(c="",h=!0);break;case"%s":c=(0,a.numberToStringWithLeadingZero)(r,2);break;case"%ss":c=(0,a.numberToStringWithLeadingZero)(o,3);break;case"%ss+":0!==o?c=(0,a.numberToStringWithLeadingZero)(o,3):(c="",h=!0);break;case"%ampm":c=n;break;default:if(h){h=!1;continue}c=t}l=c+l}return l}}},44049:(e,t,i)=>{"use strict";i.d(t,{AsyncResourceWrapper:()=>s});class s{constructor(e,t){this._destroyed=!1,this._callbacks=[],this._resource={pendingResource:e},e.then((e=>{if(this._destroyed)this._destroyFn?.(e);else{for(const t of this._callbacks)t(e);this._resource.resource=e}})).finally((()=>{this._callbacks=[]}))}destroy(){this._resource.resource&&this._destroyFn?.(this._resource.resource),this._resource={pendingResource:Promise.reject("Resource is destroyed").catch((()=>{}))},this._callbacks=[],this._destroyed=!0}callFunction(e){this._destroyed||(this._resource.resource?e(this._resource.resource):this._callbacks.push(e))}get(){return this._destroyed||!this._resource.resource?null:this._resource.resource}promise(){return this._resource.pendingResource}}}}]);