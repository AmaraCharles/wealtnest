(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[52242],{390251:(e,t,n)=>{"use strict";n.d(t,{WatchedObject:()=>r});var s=n(536794),o=n(597773);function i(e,t){return(0,s.deepEquals)(e,t)[0]}class r extends o.WatchedValue{constructor(e,t=i){super(e),this._comparator=t}setValue(e,t){!t&&this._comparator(this.value(),e)||super.setValue(e,t)}}},597773:(e,t,n)=>{"use strict";n.d(t,{WatchedValue:()=>a});var s=n(735566),o=n(954992);const i=(0,s.getLogger)("Common.WatchedValue");function r(e){i.logError(`${e&&(e.stack||e.message)}`)}class a{constructor(...e){this._listeners=[],e.length>0?this._value=e[0]:delete this._value}destroy(){this.unsubscribe()}value(){return this._owner?this._owner._value:this._value}setValue(e,t){const n=this._owner?this._owner:this;if(n.writeLock)return;const s=n._value===e||Number.isNaN(n._value)&&Number.isNaN(e);if(!t&&s&&n.hasOwnProperty("_value"))return;n._value=e;const o=n._listeners.slice();let i=0;for(let t=0;t<o.length;t++){o[t].once&&(n._listeners.splice(t-i,1),i++);try{o[t].cb(e)}catch(e){r(e)}}}deleteValue(){this.setValue(void 0)}subscribe(e,t){if("function"!=typeof e)throw new TypeError("callback must be a function");const n=!!t&&!!t.once,s=!!t&&!!t.callWithLast,o=this._owner?this._owner:this;if(s&&o.hasOwnProperty("_value")){try{e(o._value)}catch(e){r(e)}if(n)return}o._listeners.push({cb:e,owner:this,once:!!t&&!!t.once})}unsubscribe(e){const t=this._owner?this._owner:this;void 0===e&&(e=null);const n=t._listeners;for(let s=n.length;s--;)n[s].owner!==this&&t!==this||n[s].cb!==e&&null!==e||n.splice(s,1)}readonly(){if(this._readonlyInstance)return this._readonlyInstance;const e={subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this),value:this.value.bind(this),when:this.when.bind(this),ownership:this.ownership.bind(this),spawnOwnership:this.spawnOwnership.bind(this),weakReference:this.weakReference.bind(this),spawn:e=>this.spawn(e).readonly(),destroy:this.destroy.bind(this)};return this._readonlyInstance=e,e}spawn(e){return this._spawn(e)}when(e){(0,o.callWhen)(this,(e=>Boolean(e)),(()=>{try{e(this.value())}catch(e){r(e)}}))}assertNoSubscriptions(){0}ownership(){return this}release(){this.destroy()}spawnOwnership(){return this._spawn()}weakReference(){return this._spawn(void 0,!0)}_spawn(e,t){return new c(this._owner||this,e,t)}}class c extends a{constructor(e,t,n){super(),delete this._listeners,this._owner=e,this._onDestroy=t,this._weakReference=!!n}destroy(){try{this._onDestroy?.()}catch(e){r(e)}super.destroy()}readonly(){return super.readonly()}release(){this._weakReference||super.release()}}},173777:(e,t,n)=>{"use strict";n.d(t,{SEPARATOR_PREFIX:()=>s,isSeparatorItem:()=>o});const s="###";function o(e){return e.startsWith(s)}},790188:(e,t,n)=>{"use strict";n.d(t,{colorsPalette:()=>s.colorsPalette,getHexColorByName:()=>s.getHexColorByName});var s=n(336748)},927301:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalizeFirstLetterInWord:()=>_,decodeHTMLEntities:()=>l,encodeHTMLEntities:()=>u,getFirstSegmentOrCodePointString:()=>g,htmlEscape:()=>d,
removeSpaces:()=>m,removeTags:()=>h});const s=/[<"'&>]/g,o=e=>`&#${e.charCodeAt(0)};`,i={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#60;":"<","&#62;":">","&#34;":'"',"&#39;":"'","&#039;":"'","&#38;":"&"},r=Object.assign({},...Object.entries(i).map((([e,t])=>({[t]:e})))),a=new RegExp(Object.keys(i).join("|"),"g"),c=new RegExp(Object.keys(r).join("|"),"g");function l(e){return e.replace(a,(e=>i[e]||e))}function u(e){return e.replace(c,(e=>r[e]||e))}function d(e){return e.replace(s,o)}function h(e=""){return e.replace(/(<([^>]+)>)/gi,"")}function m(e=""){return e.replace(/\s+/g,"")}function _(e=""){return e.replace(/\b\w/g,(e=>e.toUpperCase()))}function g(e){const t=Intl.Segmenter;if(t){const n=new t(void 0,{granularity:"grapheme"}),[{segment:s}={segment:null}]=n.segment(e);return s?.toUpperCase()??null}{const t=e.codePointAt(0);return t?String.fromCodePoint(t).toUpperCase():null}}},62889:(e,t,n)=>{"use strict";n.d(t,{CopyrightPosition:()=>s,copyrightLabel:()=>l});var s,o=n(444372),i=n(497754),r=n(536794),a=n(995683),c=n(828133);function l({svgText:e,icon:t,theme:l,url:u,mode:d,verticalPosition:h=s.Vertical.Bottom,horizontalPosition:m=s.Horizontal.End,snapToEdge:_=!0,isExpanded:g=!1,className:p}){let f;switch(d){case"new":case"with_border":case"large_trade":f=(0,r.clone)(l);break;default:f=(0,a.mergeThemes)((0,r.clone)(c),l)}const w=document.createElement("span");let y;u&&(y=document.createElement("a"),y.classList.add(...f.label__link.split(/\s/)),y.href=u,y.target="_blank",y.rel="noopener noreferrer",y.setAttribute("data-target-type","copyright"),y.ariaLabel=o.t(null,void 0,n(15572)),w.append(y)),w.className=i(f.label,m===s.Horizontal.Start&&f.start,m===s.Horizontal.End&&f.end,h===s.Vertical.Top&&f.top,h===s.Vertical.Bottom&&f.bottom,_&&"large_trade"!==d&&f.snap,"large_old"===d&&f.large,(g||"large_trade"===d)&&f.expanded,p,"js-copyright-label"),w.addEventListener("click",(()=>{function e(){w.classList.remove(f.expandedByClick),w.removeEventListener("mouseleave",e)}w.classList.contains(f.expandedWithTransition)||w.classList.contains(f.expanded)||(w.classList.contains(f.expandedByClick)?u||e():(w.classList.add(f.expandedByClick),w.addEventListener("mouseleave",e)))}));const b=document.createElement("span");b.className=f.logoWrap,b.innerHTML=t;const C=document.createElement("span");return C.className=f.svgTextWrap,C.innerHTML=e,w.append(b,C),[w,f]}!function(e){let t,n;!function(e){e[e.Bottom=0]="Bottom",e[e.Top=1]="Top"}(t=e.Vertical||(e.Vertical={})),function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(n=e.Horizontal||(e.Horizontal={}))}(s||(s={}))},351079:(e,t,n)=>{"use strict";n.d(t,{CopyrightPosition:()=>o.CopyrightPosition,createCopyrightLabel:()=>r});var s=n(497754),o=n(62889),i=n(952598);function r({sheriffOptions:e,...t}){const[n,r]=(0,o.copyrightLabel)(t),a=e&&e.includes(i.KnownAction.Expand),c=e&&e.includes(i.KnownAction.LargeTradeLogo);return n.className=s(n.className,(a||c)&&r.expandedWithTransition),n}},23580:(e,t,n)=>{"use strict";function s(e,t){
return e&&e.utm_campaign&&(e.utm_campaign+=`-${t}`),e}async function o(e,t,s,o){if("lentaru"===e){const{getLentaCopyrightData:e}=await Promise.all([n.e(90431),n.e(1523)]).then(n.bind(n,466672));return e()}if("cmoneycomtw"===e){const{getCmoneycomtwCopyrightData:e}=await Promise.all([n.e(47597),n.e(99578),n.e(42091)]).then(n.bind(n,20922));return e(t,s)}if("new"===o){const{getTradingViewCopyrightData:e}=await Promise.all([n.e(88380),n.e(36228)]).then(n.bind(n,703094));return e(t,s)}if("with_border"===o){const{getTradingViewCopyrightData:e}=await Promise.all([n.e(62764),n.e(37753)]).then(n.bind(n,513316));return e(t,s)}if("large_trade"===o){const{getTradingViewCopyrightData:e}=await Promise.all([n.e(52431),n.e(47259)]).then(n.bind(n,203515));return e(t,s)}{const{getTradingViewCopyrightData:e}=await Promise.all([n.e(47597),n.e(53259)]).then(n.bind(n,88136));return e(t,s)}}n.d(t,{addUtmCampaignSource:()=>s,getCustomerCopyrightData:()=>o})},650401:(e,t,n)=>{"use strict";n.d(t,{getWidgetSheriffActions:()=>l});var s=n(735566),o=n(803912),i=n(952598);const r=window.WIDGET_SHERIFF_HOST||"https://widget-sheriff.xstaging-widget.tv",a=(0,s.getLogger)("WidgetSheriff.Widget");let c=null;async function l(){return null===c&&(c=await async function(){const e=function(){if(document.location.ancestorOrigins&&document.location.ancestorOrigins.length)return document.location.ancestorOrigins[document.location.ancestorOrigins.length-1];try{return new URL(document.referrer).origin}catch(e){return document.location.origin||null}}();if(null===e)return a.logWarn("ancestorOrigin is undefined"),Promise.resolve([]);const t=new URL("/sheriff/api/v1/rules/search",r);t.searchParams.append("origin",e);return(await(0,o.fetch)(t.toJSON()).then((e=>{if(!e.ok)throw new Error("Guard request error occured");return 204===e.status?Promise.resolve({actions:[]}):e.json()})).catch((e=>(a.logWarn(e.message),Promise.resolve({actions:[]}))))).actions.filter((e=>i.widgetSheriffActions.has(e)))}()),Promise.resolve(c)}},100366:(e,t,n)=>{"use strict";async function s(){return(await Promise.all([n.e(27741),n.e(61171),n.e(87682),n.e(82321),n.e(20139)]).then(n.bind(n,254543))).ErrorCardRenderer}n.d(t,{getErrorCardRenderer:()=>s})},125226:(e,t,n)=>{"use strict";n.d(t,{isFeatureEnabled:()=>_,onFeaturesStateChanged:()=>c});var s=n(49437),o=n(547465),i=n(855385),r=n.n(i);n(638456);const a=new o.Delegate,c=()=>a,l="forcefeaturetoggle.";const u=new class{enableFeature(e){s.TVLocalStorage.setItem(l+e,"true"),a.fire(e)}disableFeature(e){s.TVLocalStorage.setItem(l+e,"false"),a.fire(e)}resetFeature(e){s.TVLocalStorage.removeItem(l+e),a.fire(e)}onFeaturesStateChanged(){return a}};window.TradingView=window.TradingView||{},window.TradingView.FeatureToggle=u;const d="featuretoggle_seed";function h(e){try{const t=r()(e+function(){if(window.user&&window.user.id)return window.user.id;const e=s.TVLocalStorage.getItem(d);if(null!==e)return e;const t=Math.floor(1e6*Math.random());return s.TVLocalStorage.setItem(d,`${t}`),t}()),n=new DataView(t);return n.getUint32(0,!0)/4294967296}catch(e){
return.5}}function m(e,t){if(e[t]&&-1===e[t])return!1;if("true"===s.TVLocalStorage.getItem(l+t)||window.is_authenticated&&"true"===window.user?.settings?.[l+t])return!0;if("false"===s.TVLocalStorage.getItem(l+t)||window.is_authenticated&&"false"===window.user?.settings?.[l+t])return!1;if(!e[t])return!1;if(1===e[t])return!0;return h(t)<=e[t]}const _=(g=window.featureToggleState||{},window.TradingView.onWidget?.()||Promise.all([n.e(80349),n.e(34604)]).then(n.bind(n,180349)).then((e=>{e.pushStreamMultiplexer.on("featuretoggle",(e=>{const t=m(g,e.name);g[e.name]=e.state,t!==m(g,e.name)&&a.fire(e.name)}))})),m.bind(null,g));var g;window.TradingView.isFeatureEnabled=_},588948:(e,t,n)=>{"use strict";n.d(t,{getFreshInitData:()=>c,getInitData:()=>a,updateInitData:()=>r});var s=n(650151);const o=(0,n(735566).getLogger)("Common.InitData"),i=window.initData||{};function r(){window.initData&&window.initData!==i&&(Object.assign(i,window.initData),window.initData=i);const e=document.querySelectorAll('script[type="application/prs.init-data+json"]');for(let t=0;t<e.length;t++){const n=e[t];try{const e=JSON.parse((0,s.ensureNotNull)(n.textContent));Object.assign(i,e)}catch(e){o.logWarn(`Failed to parse initData element. ${e}`)}finally{(0,s.ensureNotNull)(n.parentNode).removeChild(n)}}}function a(){return i}function c(){return r(),i}},49437:(e,t,n)=>{"use strict";const{getLogger:s}=n(735566),o=s("TVLocalStorage");var i=function(){try{this.isAvailable=!0,this.localStorage=window.localStorage,this.localStorage.setItem("tvlocalstorage.available","true")}catch(e){delete this.isAvailable,delete this.localStorage}this._updateLength();try{this._report()}catch(e){}};i.prototype._report=function(){if(this.isAvailable){const e=10,t=[];for(let e=0;e<this.localStorage.length;e++){const n=this.key(e);t.push({key:n,length:String(this.getItem(n)).length})}t.sort(((e,t)=>t.length-e.length));const n=t.slice(0,e);t.sort(((e,t)=>t.key.length-e.key.length));const s=t.slice(0,e);o.logNormal(`Total amount of keys in Local Storage: ${this.length}`),o.logNormal(`Top ${e} keys with longest values: ${JSON.stringify(n)}`),o.logNormal(`Top ${e} longest key names: ${JSON.stringify(s)}`);try{navigator.storage.estimate().then((e=>{o.logNormal(`Storage estimate: ${JSON.stringify(e)}`)}))}catch(e){}}},i.prototype.length=0,i.prototype.isAvailable=!1,i.prototype.localStorage={"tvlocalstorage.available":"false"},i.prototype._updateLength=function(){if(this.isAvailable)this.length=this.localStorage.length;else{var e,t=0;for(e in this.localStorage)this.localStorage.hasOwnProperty(e)&&t++;this.length=t}},i.prototype.key=function(e){return this.isAvailable?this.localStorage.key(e):Object.keys(this.localStorage)[e]},i.prototype.getItem=function(e){return this.isAvailable?this.localStorage.getItem(e):void 0===this.localStorage[e]?null:this.localStorage[e]},i.prototype.setItem=function(e,t){this.isAvailable?this.localStorage.setItem(e,t):this.localStorage[e]=t,this._updateLength()},i.prototype.removeItem=function(e){
this.isAvailable?this.localStorage.removeItem(e):delete this.localStorage[e],this._updateLength()},i.prototype.clear=function(){this.isAvailable?this.localStorage.clear():this.localStorage={},this._updateLength()},window.TVLocalStorage=new i,e.exports.TVLocalStorage=window.TVLocalStorage},439563:(e,t,n)=>{"use strict";async function s(){const e=(await Promise.all([n.e(73034),n.e(3567),n.e(36683)]).then(n.bind(n,469449))).getTrackerInstance();return e||null}n.d(t,{getEmbedWidgetTracker:()=>s})},889267:(e,t,n)=>{"use strict";n.d(t,{factorOutBraces:()=>m,getTokenAtPos:()=>h,isBinaryOperator:()=>u,isSpread:()=>d,parseToken:()=>g,shortName:()=>_,symbolTokenEscapeRe:()=>r,tokenize:()=>l});var s=n(173777),o=n(125226);const i=/(?:[^-+\/*^\s]'|[a-zA-Z0-9_\u0370-\u1FFF_\u2E80-\uFFFF])(?:[^-+\/*^\s]'|[a-zA-Z0-9_\u0020\u0370-\u1FFF_\u2E80-\uFFFF_!|:.&])*|'.+?'/,r=/[+\-/*]/,a=(e=(0,o.isFeatureEnabled)("allow_trailing_whitespace_in_number_token"))=>({number:e?/\d+(?:\.\d*|(?![a-zA-Z0-9_!:.&]))(?:\s*(?=\s*$))?|\.\d+(?:\s*(?=\s*$))?/:/\d+(?:\.\d*|(?![a-zA-Z0-9_!:.&]))|\.\d+/,incompleteNumber:/\./,symbol:i,incompleteSymbol:/'[^']*/,separatorPrefix:s.SEPARATOR_PREFIX,openBrace:"(",closeBrace:")",plus:"+",minus:"-",multiply:"*",divide:"/",power:"^",whitespace:/[\0-\x20\s]+/,unparsed:null}),c=(e=a())=>new RegExp(Object.values(e).map((e=>{return null===e?"":`(${"string"==typeof e?(t=e,t.replace(/[\^$()[\]{}*+?|\\]/g,"\\$&")):e.source})`;var t})).filter((e=>""!==e)).concat(".").join("|"),"g");function l(e,t=a()){if(!e)return[];const n=[],s=Object.keys(t);let o;const i=c(t);for(;o=i.exec(e);){let e=!1;for(let t=s.length;t--;)if(o[t+1]){s[t]&&n.push({value:o[t+1],type:s[t],precedence:0,offset:o.index}),e=!0;break}e||n.push({value:o[0],type:"unparsed",precedence:0,offset:o.index})}return n}function u(e){return"plus"===e||"minus"===e||"multiply"===e||"divide"===e||"power"===e}function d(e){return e.length>1&&e.some((e=>u(e.type)))}function h(e,t){for(let n=0;n<e.length;n++){const s=e[n],o="symbol"===s.type||"incompleteSymbol"===s.type||"number"===s.type;if(s.offset<=t&&t<=s.offset+s.value.length&&o)return s}return null}function m(e){e=function(e){const t=[];for(const n of e)"whitespace"!==n.type&&t.push(n);return t}(e);const t=[],n=[];let s;for(let o=0;o<e.length;o++){const i=e[o];switch(i.type){case"plus":case"minus":case"multiply":case"divide":case"power":n.length&&n[n.length-1].minPrecedence>i.precedence&&(n[n.length-1].minPrecedence=i.precedence);break;case"openBrace":s={minPrecedence:1/0,openBraceIndex:o},n.push(s);break;case"closeBrace":{if(s=n.pop(),!s)break;const i=e[s.openBraceIndex-1],r=e[o+1],a=i&&("plus"===i.type||"multiply"===i.type);(!u(r?.type)||r?.precedence<=s.minPrecedence)&&(!u(i?.type)||i?.precedence<s?.minPrecedence||i?.precedence===s?.minPrecedence&&a)&&(t.unshift(s.openBraceIndex),t.push(o),n.length&&n[n.length-1].minPrecedence>s.minPrecedence&&(n[n.length-1].minPrecedence=s.minPrecedence))}}}for(let n=t.length;n--;)e.splice(t[n],1);return e}function _(e){return m(l(e)).reduce(((e,t)=>{
if("symbol"!==t.type)return e+t.value;const[,n]=g(t);return n?e+n:e}),"")}function g(e){const t=/^'?(?:([A-Z0-9_]+):)?(.*?)'?$/i.exec(e.value);return null===t?[void 0,void 0]:[t[1],t[2]]}},995683:(e,t,n)=>{"use strict";function s(e,t,n={}){return Object.assign({},e,function(e,t,n={}){const s=Object.assign({},t);for(const o of Object.keys(t)){const i=n[o]||o;i in e&&(s[o]=[e[i],t[o]].join(" "))}return s}(e,t,n))}n.d(t,{mergeThemes:()=>s})},957259:(e,t,n)=>{"use strict";n.d(t,{TVChartApi:()=>se});var s=n(154834),o=n(290484),i=n(569708),r=n(650151),a=n(735566),c=n(37010),l=n(181929),u=n(931924),d=n(894645),h=n(13692),m=n(496499),_=n(803155),g=n(803912),p=n(659923),f=n(925049),w=n(107447),y=n(800828),b=n(778016),C=n(125226),v=n(849204),S=n(314802),k=n(175203),R=n(982367),T=n(820028),M=n(646244),N=n(241361),P=n(403526),q=n(903656);const I=(0,a.getLogger)("Chart.Studies.StudyMetaInfoRepository",{color:"#606"}),D=(0,a.getLogger)("ChartApi.TrafficMeter",{maxCount:20,color:"#268"}),L=(0,a.getLogger)("ChartApi.Core",{color:"#706"}),E=(0,a.getLogger)("ChartApi.ChartSession",{color:"#706"}),O=(0,a.getLogger)("ChartApi.ChartSession",{highRate:!0,maxCount:100,color:"#706"}),A=(0,a.getLogger)("ChartApi.ChartSession",{maxCount:0,color:"#706"}),H=(0,a.getLogger)("ChartApi.ChartSession",{maxCount:50,color:"#706"}),B=(0,a.getLogger)("ChartApi.QuoteSession",{maxCount:50,color:"#660"}),x=(0,a.getLogger)("ChartApi.QuoteSession",{highRate:!0,maxCount:10,color:"#660"}),W=!(0,S.isOnMobileAppPage)("any"),V=(0,C.isFeatureEnabled)("broker_id_session");let F=!1,U=!1,$=!1;const j=["","KB","MB","GB","TB"];function Q(e){if(0===e)return"0";const t=(0,R.toInt)(Math.floor(Math.log(e)/Math.log(1024)));return(e/Math.pow(1024,t)).toFixed(2)+j[t]}function G(e,t){return`${e}__${t}`}function z(e,t,n){const s=t[n]??0;t[n]=s+e}const J=z.bind(null,1),Y=z.bind(null,-1),Z=u.enabled("widget")?"studies_metadata_widget":"studies_metadata",K="/chart-api/pro_hash",X=u.enabled("widget")?"/chart-api/studies_metadata_widget":"/chart-api/studies_metadata";function ee(e){if(null===e)return"";if("period-back"===e.type){let t=e.value;return"YTD"!==t&&"D"===t.slice(-1)&&(t=t.slice(0,-1)),t}return"r,"+e.from+":"+e.to}let te=null;function ne(){if(null===te){const e=document.querySelector('link[rel~="conversions-config"]'),t=new URL((0,r.ensureNotNull)(e).href);te=(0,g.fetch)(t.toString(),{method:"GET"}).then((e=>{if(!e.ok)throw new Error("Response status is not success");return e.json()})).then((e=>{const t=(0,v.getLogoUrlResolver)();return e.currencies.forEach((e=>{void 0!==e.logoid&&(e.logoUrl=t.getSymbolLogoUrl(e.logoid,v.LogoSize.Medium))})),e}))}return te}class se{constructor(e){this.sessionid=null,this._banInfo=new T.WatchedValue(null),this._isAuthTokenLoaded=!1,this._authTokenDfd=null,this._serverTimeBasePoint=Date.now()-performance.now(),this._initCachePromise=(0,y.createCache)("TVChartApi"),this._trafficStats={total:0,sinceConnect:0,lastChunk:0},this._lowQualityEnabled=!1,this._brokerId="",this._sendingQueuedRequestsCount=0,this._modifyStudyMap=new Map,
this._disconnectCount=0,this._isConnected=!1,this._metadataDeferredPromise=null,this._dataHandleModule=new P.JSONDataHandler,this._sessions={},this._notificationHandlers={},this._pendingMessagesQueue=[],this._loadNewBars=!1,this._metadataRequestNextNumber=1,this._fundamentalCounter={},this._studyCounter={},this._childStudyCounter={},this._studySpecs=new Map,this._connectionsLimitReached=new T.WatchedValue(!1),this._sentMethodsCounters=new Map,this._receivedMethodsCounters=new Map,this._requestDataProblemsPromise=null,this._wsBackendConnection=e,this._wsBackendConnection.onReconnect(this._bindSocketEvents.bind(this)),this._wsBackendConnection.setLogger(L,a.getLogHistory),this._wsBackendConnection.setTelemetry(k.telemetry),this._bindSocketEvents(),this._isNonCountedStudy=()=>!0,setInterval((()=>{D.logNormal("Last 30 seconds:"+Q(this._trafficStats.lastChunk)+" Since last connect:"+Q(this._trafficStats.sinceConnect)+" Total traffic:"+Q(this._trafficStats.total)),this._trafficStats.lastChunk=0}),3e4),this._connectionsLimitReached.subscribe((e=>{e&&this.disconnect()}))}connect(e){this._connectOnlyOptions=e,this._wsBackendConnection.isConnected()||this._wsBackendConnection.isConnecting()||this._wsBackendConnection.connect()}disconnect(){this._wsBackendConnection.disconnect()}sentMethodsCounters(){return this._sentMethodsCounters}receivedMethodsCounters(){return this._receivedMethodsCounters}defaultResolutions(){return(0,d.getDefaultResolutions)()}availableCurrencies(){return ne().then((e=>e.currencies))}availableUnits(){return ne().then((e=>{const t={};for(const n of e.units)t[n.type]||(t[n.type]=[]),t[n.type].push(n);return t}))}availablePriceSources(){return Promise.resolve([])}supportedSymbolsTypes(){const e=window.TradingView?.widgetCustomer??"";return"bovespa"===e?_.filter((e=>["","stock","futures","index"].includes(e.value))):"cme"===e?_.filter((e=>e.value!==h.types.QUANDL)):_}symbolsGrouping(){return{futures:/^(.+?)([12]!|\w\d{4})?$/}}connected(){return!!this._isConnected}authTokenManager(){return(0,r.ensureDefined)(this._authTokenManager)}createSession(e,t){this._sessions[e]=t,this._notificationHandlers[e]={},this.connected()&&this._isAuthTokenLoaded&&t.onMessage({method:l.ChartApiMessageMethod.Connected,params:[]})}removeSession(e){delete this._sessions[e],delete this._notificationHandlers[e]}disconnectCount(){return this._disconnectCount||0}getPingInfo(){return this._wsBackendConnection.getPingInfo()}connectionBanInfo(){return this._banInfo.readonly()}connectionsLimitReached(){return this._connectionsLimitReached.readonly()}serverTime(){return Math.round(this._serverTimeBasePoint+performance.now())}compensateConnectionLag(e){const t=this.serverTime(),n=Math.floor(e-t);n>0&&(this._serverTimeBasePoint+=n)}setBroker(e){return e===this._brokerId||(this._brokerId=e,this._sendBrokerIdToSession(this._brokerId))}chartCreateSession(e,t){return this._sendRequest("chart_create_session",[e,t])}chartDeleteSession(e){return this._sendRequest("chart_delete_session",[e])}switchTimezone(e,t){
return this._sendRequest("switch_timezone",[e,t])}resolveSymbol(e,t,n,s){return k.telemetry.timeCounters.series["resolve_symbol_"+e]=window.performance.now(),this._notificationHandlers[e][t]=new q.HandlerInfo(s,t,!0),this._sendRequest("resolve_symbol",[e,t,n])}requestFirstBarTime(e,t,n,s){return this._notificationHandlers[e][t]=new q.HandlerInfo(s,t,!0),this._sendRequest("get_first_bar_time",[e,t,n])}createSeries(e,t,n,s,o,i,r,a){k.telemetry.timeCounters.series.marks.push("create_series_"+e),this._notificationHandlers[e][t]=new q.HandlerInfo(a,t);const c=ee(r);return this._sendRequest("create_series",[e,t,n,s,o,i,c])}removeSeries(e,t){return delete this._notificationHandlers[e][t],this._sendRequest("remove_series",[e,t])}modifySeries(e,t,n,s,o,i,r,a){this._notificationHandlers[e][t]=new q.HandlerInfo(a,t);const c=ee(r);return this._sendRequest("modify_series",[e,t,n,s,o,c])}getStudyCounter(e){return this._studyCounter[e]??0}getFundamentalCounter(e){return this._fundamentalCounter[e]??0}requestMoreData(e,t,n,s){if(void 0===n||void 0===s)throw new Error("unsupported request to load more data, bars="+n);const o=t;return this._notificationHandlers[e][o]=new q.HandlerInfo(s,o),this._sendRequest("request_more_data",[e,o,n])}requestMoreTickmarks(e,t,n,s){return s&&(this._notificationHandlers[e][t]=new q.HandlerInfo(s,t)),this._sendRequest("request_more_tickmarks",[e,t,n])}setFutureTickmarksMode(e,t){this._sendRequest("set_future_tickmarks_mode",[e,t])}requestDataProblems(){return this._requestDataProblemsPromise||(this._requestDataProblemsPromise=this.connectDfd.then((()=>new Promise(((e,t)=>{this._onDataProblemsPromiseErrback=t,this._sendRequest("request_data_problems",[])?this._onDataProblemsPromiseCb=e:t()})))).finally((()=>{this._requestDataProblemsPromise=null}))),this._requestDataProblemsPromise}async requestMetadata(){return null===this._metadataDeferredPromise&&(this._metadataDeferredPromise=(0,f.createDeferredPromise)(),this._metadataDeferredPromise.promise.finally((()=>{this._metadataDeferredPromise=null})),this._requestMetadata()),this._metadataDeferredPromise.promise}allStudiesMetadata(){throw new Error("This method is not implemented")}setLoadNew(e){this._loadNewBars=!!e}setIsNonCountedStudyFn(e){this._isNonCountedStudy=e}canCreateStudy(e,t,n){const{id:s,child:o,fundamental:i}=t,a=(0,r.ensureNotNull)((0,b.getConfig)("STUDY_ON_STUDY")).child_limit;if(o&&(!(0,b.enabled)("STUDY_ON_STUDY")||(this._childStudyCounter[e]??0)>=a))return{success:!1,reason:"child",limitValue:a};if(n)return{success:!0};const c=(0,r.ensureNotNull)((0,b.getConfig)("FUNDAMENTALS_ON_CHART")).limit;if(i&&(!(0,b.enabled)("FUNDAMENTALS_ON_CHART")||this.getFundamentalCounter(e)>=c))return{success:!1,reason:"fundamental",limitValue:c};const l=(0,r.ensureNotNull)((0,b.getConfig)("INDICATORS_ON_CHART")).limit;return i||this._isNonCountedStudy(s)||(0,b.enabled)("INDICATORS_ON_CHART")&&!(this.getStudyCounter(e)>=l)?{success:!0}:{success:!1,reason:"general",limitValue:l}}createStudy(e,t,n,s,o,i,r,a){const c=this.canCreateStudy(e,a)
;return c.success||"child"!==c.reason?(this._notificationHandlers[e][t]=new q.HandlerInfo(r,t),this._sendRequest("create_study",[e,t,n,s,o,i]),a.fundamental?J(this._fundamentalCounter,e):this._isNonCountedStudy(a.id)||J(this._studyCounter,e),a.child&&J(this._childStudyCounter,e),this._studySpecs.set(G(e,t),a),!0):((0,p.showTooManyStudiesNotice)(c.limitValue),!1)}modifyStudy(e,t,n,s,i,a){z(a=a??0,this._childStudyCounter,e),0!==a&&((0,r.ensureDefined)(this._studySpecs.get(G(e,t))).child=a>0),this._notificationHandlers[e][t]=new q.HandlerInfo(i,t);const c=e+t;if(this._modifyStudyMap.has(c)){return(0,r.ensureDefined)(this._modifyStudyMap.get(c))(e,t,n,s)??!0}{const i=(0,o.default)(((e,t,n,s)=>this._sendRequest("modify_study",[e,t,n,s])),500,{maxWait:550});return this._modifyStudyMap.set(c,i),i(e,t,n,s)??!0}}notifyStudy(e,t,n,s){return L.logNormal(`Send notify_study, [${e}, ${t}, ${n}, ${JSON.stringify(s)}]`),this._sendRequest("notify_study",[e,t,n,JSON.stringify(s)])}removeStudy(e,t){const n=e+t;delete this._notificationHandlers[e][t],this._modifyStudyMap.get(n)?.flush();const s=this._sendRequest("remove_study",[e,t]);if(!1===s)return!1;this._modifyStudyMap.delete(n);const o=G(e,t),i=(0,r.ensureDefined)(this._studySpecs.get(o));return this._studySpecs.delete(o),i.fundamental?Y(this._fundamentalCounter,e):this._isNonCountedStudy(i.id)||Y(this._studyCounter,e),i.child&&Y(this._childStudyCounter,e),s}createPointset(e,t,n,s,o,i,r){return this._notificationHandlers[e][t]=new q.HandlerInfo(r,t),this._sendRequest("create_pointset",[e,t,n,s,o,i])}modifyPointset(e,t,n,s,o){return this._notificationHandlers[e][t]=new q.HandlerInfo(o,t),this._sendRequest("modify_pointset",[e,t,n,s])}removePointset(e,t){return delete this._notificationHandlers[e][t],this._sendRequest("remove_pointset",[e,t])}getMarks(e,t,n,s,o){throw Error("This method is not implemented")}getTimescaleMarks(e,t,n,s,o){throw Error("This method is not implemented")}quoteCreateSession(e){return this._sendRequest("quote_create_session",[e])}quoteDeleteSession(e){return this._sendRequest("quote_delete_session",[e])}quoteAddSymbols(e,t){return this._sendRequest("quote_add_symbols",[e,t])}quoteRemoveSymbols(e,t){return this._sendRequest("quote_remove_symbols",[e,t])}quoteFastSymbols(e,t){return this._sendRequest("quote_fast_symbols",[e,t])}quoteSetFields(e,t){return this._sendRequest("quote_set_fields",[e,t])}quoteHibernateAll(e){return this._sendRequest("quote_hibernate_all",[e])}depthCreateSession(e,t,n){return this._sendRequest("depth_create_session",[e,t,n])}depthDeleteSession(e){return this._sendRequest("depth_delete_session",[e])}depthSetSymbol(e,t){return this._sendRequest("depth_set_symbol",[e,t])}depthClearSymbol(e){return this._sendRequest("depth_clear_symbol",[e])}depthSetScale(e,t){return this._sendRequest("depth_set_scale",[e,t])}unpack(e){return this._dataHandleModule.unpack(e)}sendRequest(e,t){return this._sendRequest(e,t)}enableLowQualityMode(){this._lowQualityEnabled=!0,this._sendLowQualityModeIfEnabled()}_init(){this._notificationHandlers={},
this._studyCounter={},this._childStudyCounter={},this._fundamentalCounter={},this._modifyStudyMap=new Map}_sendRequest(e,t){const n=this._sentMethodsCounters.get(e)??0;if(this._sentMethodsCounters.set(e,n+1),0!==this._sendingQueuedRequestsCount)return this._pendingMessagesQueue.push({method:e,args:t}),!0;const s=this._dataHandleModule[e].apply(this._dataHandleModule,t),o={m:e,p:s},i=JSON.stringify(o);if(s.length>0){const e=s[0];e.startsWith("qs_")?B.logNormal("send: "+i):e.startsWith("cs_")&&E.logNormal("send: "+i)}else L.logNormal("send: "+i);const r=this._dataHandleModule.prepareEncodeMessage(e,s);return this._wsBackendConnection.send(r)}_onConnect(){if(this.connected())return;if(this._trafficStats.sinceConnect=0,this._isAuthTokenLoaded=!1,this._connectOnlyOptions=this._connectOnlyOptions||{},this._authTokenDfd=this._getAuthTokenDfd(this._connectOnlyOptions.tokenGrabSession),this._connectOnlyOptions={},this.sessionid=this._wsBackendConnection.getSessionId(),!this.sessionid||this._isConnected)return;this._pendingMessagesQueue=[],this._sendingQueuedRequestsCount=0,this._studyCounter={},this._childStudyCounter={},this._fundamentalCounter={},this._studySpecs.clear(),this._isConnected=!0,this._banInfo.setValue(null),this._connectionsLimitReached.setValue(!1);const e=JSON.parse(this.sessionid);this._sendLowQualityModeIfEnabled(),this._metadataServerHash=e.studies_metadata_hash||null;const t=this._wsBackendConnection.getConnectionEstablished();try{this._serverTimeBasePoint=Math.round(e.timestampMs-t)}catch(e){this._serverTimeBasePoint=Date.now()-performance.now()}if(L.logInfo("Time shift with server: "+this._formatTime(this.serverTime()-Date.now())),this._authTokenDfd){this._sendingQueuedRequestsCount+=1,L.logInfo("Wait for auth token before send messages");const e=this._authTokenDfd;e.then((t=>{if(null!==this._authTokenDfd&&this._authTokenDfd===e){if(L.logNormal("Auth token request is finished, token: "+Boolean(t)),this._authTokenDfd=null,t){const e=[{method:"set_auth_token",args:[t]}];if(W){const t=window.initData&&window.initData.currentLocaleInfo;t&&e.push({method:"set_locale",args:[t.iso,t.flag.toUpperCase()]})}this._pendingMessagesQueue.unshift(...e)}this._onSendingQueueRequestFinished(),this._isAuthTokenLoaded=!0,this._notifySessions({method:l.ChartApiMessageMethod.Connected,params:[]})}else L.logNormal("Comes auth token after requesting new token or after socket disconnected")})).catch((e=>{L.logNormal((0,w.errorToString)(e))}))}else L.logWarn("Deferred auth token object is not valid"),this._isAuthTokenLoaded=!0;""!==this._brokerId&&this._sendBrokerIdToSession(this._brokerId);const n=this._wsBackendConnection.getConnectionStart();k.telemetry.setSessionInfo(this.sessionid),k.telemetry.sendChartReport("websocket_connected"),k.telemetry.sendChartReport("websocket_connection_time_frame",{value:t-n}),k.telemetry.sendChartReport("reconnect_count_frame",{value:this._wsBackendConnection.getReconnectCount()}),k.telemetry.sendChartReport("redirect_count_frame",{value:this._wsBackendConnection.getRedirectCount()}),F||(F=!0,
k.telemetry.sendChartReport("before_websocket_connection_time_frame",{value:n})),this._wsBackendConnection.resetCounters(),clearTimeout(this._telemetryDisconnectTimeout)}_formatTime(e){return`${(e/1e3).toFixed(2)} seconds.`}_dispatchNotification(e,t){if("request_data_problems"===e.method&&this._onDataProblemsPromiseCb)return void this._onDataProblemsPromiseCb(e.params);if(e.method===N.WebchartChartSessionResponseMethod.StudiesMetadata&&null!==this._metadataDeferredPromise)return void this._processedMetadata(e);const n=e.params.shift();if(!this._notificationHandlers[n])return;if("symbol_resolved"===e.method){const t=e.params[1].full_name;k.telemetry.sendChartReport("symbol_resolved",{count:1,additional:{symbol:t}});const s=k.telemetry.timeCounters.series["resolve_symbol_"+n];"number"==typeof s&&k.telemetry.sendChartReport("symbol_resolve_time_frame",{value:window.performance.now()-s,additional:{symbol:t}})}if(["series_error","series_completed"].includes(e.method)&&k.telemetry.timeCounters.series.marks.length>0){const e="create_series_"+n,t=k.telemetry.timeCounters.series.marks.indexOf(e);t>=0&&k.telemetry.timeCounters.series.marks.splice(t,1)}$||"series_error"!==e.method||($=!0);const s=this._wsBackendConnection.getConnectionEstablished();if(null!==s&&"series_completed"===e.method&&($||($=!0,k.telemetry.sendChartReport("first_series_full_time_frame",{value:window.performance.now()-s}),k.telemetry.timeCounters.series.marks=[]),U||(U=!0,k.telemetry.sendChartReport("page_full_load_time_frame",{value:window.performance.now()}))),n.startsWith("cs_")){let n="recv: "+t;"data_update"===e.method?(n=(0,a.isHighRateEnabled)()?n:n.slice(0,500),O.logNormal(this._appendDuration(n,e.time))):"study_loading"===e.method?A.logNormal(this._appendDuration(n,e.time)):"tickmark_update"===e.method?H.logNormal(this._appendDuration(n,e.time)):E.logNormal(this._appendDuration(n,e.time))}if(n.startsWith("qs_")){("quote_symbol_data"===e.method?x.logNormal:B.logNormal)("recv: "+t)}switch(e.method){case N.WebchartChartSessionResponseMethod.TimeScaleUpdate:{const t=this._dataHandleModule.getTimescaleObjects(e),s=this._dataHandleModule.getTimescaleChangeset(e),o=this._convertTimescaleResponse(s);this._sessions[n].onMessage({method:N.WebchartChartSessionResponseMethod.TimeScaleUpdate,params:o}),this._dataHandleModule.prepareDataUpdateObjects(n,t,((e,t,n)=>{this._invokeNotificationHandler(e,t,n)}));break}case"tickmark_update":const t={...this._convertTimescaleResponse(e.params[0]),changes:[]};this._sessions[n].onMessage({method:N.WebchartChartSessionResponseMethod.TimeScaleUpdate,params:t});break;case N.WebchartChartSessionResponseMethod.DataUpdate:{const t=this._dataHandleModule.getDataUpdateObjects(e);this._dataHandleModule.prepareDataUpdateObjects(n,t,((e,t,n)=>{this._invokeNotificationHandler(e,t,n)}));break}case"index_update":for(const t in e.params[0])if(e.params[0].hasOwnProperty(t)){const s={method:"index_update",params:e.params[0][t]};this._invokeNotificationHandler(n,t,s)}break;case N.WebchartResponseMethod.CriticalError:
L.logInfo(new Date+" critical_error session:"+this.sessionid+" reason:"+e.params[0]),k.telemetry.sendChartReport("critical_error"),this._sessions[n].onMessage({method:N.WebchartResponseMethod.CriticalError,params:e.params});break;case"timescale_completed":case"quote_symbol_data":case"quote_list_fields":case"quote_completed":case"depth_symbol_error":case"depth_symbol_success":case"dd":case"dpu":case"depth_bar_last_value":this._sessions[n].onMessage({method:e.method,params:e.params});break;case"clear_data":for(const t in e.params[0])e.params[0].hasOwnProperty(t)&&this._invokeNotificationHandler(n,t,{method:N.WebchartChartSessionResponseMethod.ClearData,params:e.params[0][t]});break;case N.WebchartReplaySessionResponseMethod.ReplayPoint:case N.WebchartReplaySessionResponseMethod.ReplayResolutions:case N.WebchartReplaySessionResponseMethod.ReplayDataEnd:case N.WebchartReplaySessionResponseMethod.ReplayInstanceId:case N.WebchartReplaySessionResponseMethod.ReplayDepth:case N.WebchartReplaySessionResponseMethod.ReplayError:case N.WebchartReplaySessionResponseMethod.ReplayOk:this._sessions[n].onMessage(e);break;case"series_timeframe":e.params[4]=function(e){if(null==e)return null;const t=/r,(\d+):(\d+)/.exec(e);return null!==t?{from:Number(t[1]),to:Number(t[2]),type:"time-range"}:{value:e,type:"period-back"}}(e.params[4]),this._invokeNotificationHandler(n,e.params[0],e);break;case"symbol_resolved":!function(e){if(void 0===e.corrections){const t=(e.subsessions??[]).find((t=>t.id===e.subsession_id));void 0!==t&&(e.corrections=t["session-correction"])}}(e.params[1]),this._invokeNotificationHandler(n,e.params[0],e);break;default:this._invokeNotificationHandler(n,e.params[0],e)}}_notifySessions(e){for(const t in this._sessions)if(this._sessions.hasOwnProperty(t)){const n=this._sessions[t];"function"==typeof n.onMessage&&n.onMessage(e)}}_onMessage(e){this._calcTrafficStats(e);const t=this.unpack(e);this._receivedMethodsCounters.set(t.method,(this._receivedMethodsCounters.get(t.method)??0)+1),"t_ms"in t&&(0,i.default)(t.t_ms)&&window.ChartApiInstance.compensateConnectionLag(t.t_ms),"protocol_switched"!==t.method?"protocol_error"!==t.method?this._dispatchNotification(t,e):this._processProtocolError(t):L.logError("Unexpected protocol changing request, try skipping. Requested protocol:"+t.params[0])}async _processedMetadata(e){const t=(0,r.ensureNotNull)(this._metadataDeferredPromise),n=await this._initCachePromise,o=window.pro.hash(),i=u.enabled("widget");try{await n.setValue(X,(0,s.default)(e));const r=Array.from(new Set(e.params[1].metainfo.map((e=>{return`${(t=(0,M.parseIdString)(e.id)).packageId}-${t.version}`;var t}))));if(L.logNormal(`Updated studies_metadata cache, unique package ids: ${r.join(", ")}`),!i)try{await n.setValue(K,(0,s.default)(o)),L.logNormal("Updated pro_hash cache")}catch(e){t.reject(),L.logError("Cannot update pro_hash cache, reason: "+e)}}catch(e){t.reject(),L.logError("Cannot update studies_metadata cache, reason: "+e)}t.resolve((0,s.default)(e))}_invokeNotificationHandler(e,t,n){if(void 0===t)return
;const s=this._notificationHandlers[e][t];void 0!==s&&(s.singleShot&&delete this._notificationHandlers[e][t],s.handler?.(n))}_convertTimescaleResponse(e){return this._dataHandleModule.convertTimescaleResponse(e)}_appendDuration(e,t){return t?`${e}, duration: ${this._formatTime(this.serverTime()-1e3*t)}`:e}async _requestMetadata(){const e=this._makeNextRequestId();I.logNormal(`Requesting metainfo #${e}`);const t=(0,r.ensureNotNull)(this._metadataDeferredPromise),n=window.pro,o=n.hash(),i=u.enabled("widget");L.logNormal("Requesting pro hash");try{const r=await this._initCachePromise;await r.migrateValue("pro_hash",K),await r.migrateValue(Z,X);const a=await r.getValue(K);if(null!==a&&a===o||i){L.logNormal("Pro hash has not changed, requesting from local");const i=await r.getValue(X),a=null!==i&&i.params[1].hash||null;if(null===a||null===this._metadataServerHash||this._metadataServerHash!==a)L.logNormal(`Metadata hash has changed (cached: '${a}', server: '${this._metadataServerHash}')`),this._requestMetadataFromServer(e);else{if(!n.hasPackage("tv-volumebyprice")||void 0!==i.params[1].metainfo.find((e=>e.id.includes("@tv-volumebyprice"))))return L.logNormal("Using studies_metadata from browser cache"),void t.resolve((0,s.default)(i));L.logNormal(`De-sync detected! pro.hash contains VbPR studies, but data from cache doesn't and pro.hash isn't changed, pro.hash=${o}`),this._requestMetadataFromServer(e)}}else L.logNormal(`Pro hash has changed (cached: '${a}', current: '${o}')`),this._requestMetadataFromServer(e)}catch(t){L.logError("Cannot get studies_metadata, reason: "+t),this._requestMetadataFromServer(e)}finally{I.logNormal(`Requesting studies metadata #${e} finished`)}}_makeNextRequestId(){return"metadata_"+this._metadataRequestNextNumber++}_processProtocolError(e){const t=e.params[0];L.logError(`Protocol error. Reason=${t}.`),"banned"!==t&&"banned by user_id"!==t&&"banned by ip"!==t||(this._banInfo.setValue({reason:t}),this.disconnect()),this._connectionsLimitReached.setValue("user connections limit reached"===t)}_requestMetadataFromServer(e){return L.logNormal("Request studies_metadata from server"),this._sendRequest("request_studies_metadata",[e])}_bindSocketEvents(){this.connectDfd=new Promise(((e,t)=>{this._wsBackendConnection.on("connect",(()=>{this._onConnect(),e()})),this._wsBackendConnection.on("message",this._onMessage.bind(this)),this._wsBackendConnection.on("disconnect",(()=>{this._authTokenDfd&&(this._authTokenDfd=null),this._onDataProblemsPromiseErrback&&this._onDataProblemsPromiseErrback(),this._isConnected=!1,this._notifySessions({method:l.ChartApiMessageMethod.Disconnected,params:[]}),this._banInfo.value()||(this._metadataDeferredPromise=null),this._disconnectCount=(this._disconnectCount||0)+1,this._wsBackendConnection.isConnected()&&(this._telemetryDisconnectTimeout=setTimeout((()=>{k.telemetry.sendChartReport("disconnect")}),5e3),this._wsBackendConnection.isMaxReconnects()&&(this._notifySessions({method:l.ChartApiMessageMethod.ReconnectBailout,params:[]}),t(),
k.telemetry.sendChartReport("reconnect_bailout")))}))}))}_calcTrafficStats(e){const t=e.length;this._trafficStats.total+=t,this._trafficStats.sinceConnect+=t,this._trafficStats.lastChunk+=t}_sendBrokerIdToSession(e){return!V||this._sendRequest("set_broker",[e])}_sendLowQualityModeIfEnabled(){this._lowQualityEnabled&&this.connected()&&this._sendRequest("set_data_quality",[])}_getAuthTokenDfd(e){if(this._loadNewBars)return Promise.resolve("load_new_token");if(u.enabled("widget")||-1!==window.location.search.indexOf("widget_token")||-1!==window.location.hash.indexOf("widget_token")){const e=window.TradingView&&window.TradingView.widgetCustomer||"";return Promise.resolve(m[e]||"widget_user_token")}return window.is_authenticated?(this._authTokenManager||(this._authTokenManager=new c.AuthToken,this._authTokenManager.invalidated.subscribe(null,(()=>{this._authTokenManager?.get().then((e=>{e&&this.connected()&&this._sendRequest("set_auth_token",[e])}))}))),this._authTokenManager.get(e)):Promise.resolve("unauthorized_user_token")}_onSendingQueueRequestFinished(){this._sendingQueuedRequestsCount-=1,L.logInfo(`Sending queue request finished. Remaining pending requests=${this._sendingQueuedRequestsCount}`),this._sendingQueuedRequestsCount<0&&L.logError(`Invalid queue state=${this._sendingQueuedRequestsCount}`),0===this._sendingQueuedRequestsCount&&this._flushPendingMessages()}_flushPendingMessages(){L.logInfo(`Flush pending messages. Count=${this._pendingMessagesQueue.length}`),this._pendingMessagesQueue.forEach((e=>this._sendRequest(e.method,e.args))),this._pendingMessagesQueue=[]}}window.ChartApiInstance=new se(window.WSBackendConnection)},534197:(e,t,n)=>{"use strict";n.r(t),n.d(t,{destroyQuoteSessions:()=>c,getQuoteSessionInstance:()=>i,getQuoteSessionNoEnsure:()=>a,setQuoteSessionInstance:()=>r});var s=n(288533);const o={};function i(e="full"){return o[e]||r(e,new s(e)),o[e]}function r(e="full",t){o[e]=t}function a(e="full"){return o[e]}function c(){for(const e in o)if(o.hasOwnProperty(e)){const t=o[e];void 0!==t&&t.destroy(),delete o[e]}}},778003:(e,t,n)=>{"use strict";function s(e){if(void 0===e)return null;const t=e.match(/(delayed_streaming)_(\d+)/);return null===t?null:{mode:t[1],interval:parseInt(t[2])}}function o(e){const t=s(e.update_mode);return null===t||(e.update_mode=t.mode,e.update_mode_seconds=t.interval),e}n.r(t),n.d(t,{normalizeUpdateMode:()=>o,parseUpdateMode:()=>s})},547465:(e,t,n)=>{"use strict";n.d(t,{Delegate:()=>i});const s=(0,n(735566).getLogger)("Common.Delegate");function o(e){return!e.singleShot}class i{constructor(){this.fire=this._fireImpl.bind(this),this._listeners=[]}subscribe(e,t,n){this._listeners.push({object:e,member:t,singleShot:!!n,skip:!1})}unsubscribe(e,t){for(let n=0;n<this._listeners.length;++n){const s=this._listeners[n];if(s.object===e&&s.member===t){s.skip=!0,this._listeners.splice(n,1);break}}}unsubscribeAll(e){for(let t=this._listeners.length-1;t>=0;--t){const n=this._listeners[t];n.object===e&&(n.skip=!0,this._listeners.splice(t,1))}}destroy(){this._listeners=[]}_fireImpl(...e){
const t=this._listeners;this._listeners=this._listeners.filter(o);const n=t.length;for(let o=0;o<n;++o){const n=t[o];if(!n.skip)try{n.member.apply(n.object||null,e)}catch(e){s.logError(`${e&&(e.stack||e.message)}`)}}}}},982367:(e,t,n)=>{"use strict";function s(e,t){return e<=t}function o(e,t){return e>=t}function i(e,t,n){return Math.min(Math.max(e,t),n)}function r(e){return e<0?-1:e>0?1:0}function a(e){if(e<0)return!1;if(e>1e18)return!0;for(let t=e;t>1;t/=10)if(t%10!=0)return!1;return!0}function c(e,t,n){return t-e<=n}function l(e,t,n){return Math.abs(e-t)<n}function u(e){return e<=0?NaN:Math.log(e)/Math.log(10)}function d(e,t){return e<t?-1:e>t?1:0}function h(e,t=d){if(e.length<1)throw Error("array is empty");let n=e[0];for(let s=0;s<e.length;++s)t(e[s],n)<0&&(n=e[s]);return n}function m(e,t=d){if(e.length<1)throw Error("array is empty");let n=e[0];for(let s=0;s<e.length;++s)t(e[s],n)>0&&(n=e[s]);return n}function _(e){const t=Math.ceil(e);return t%2!=0?t-1:t}function g(e){return e>0?Math.floor(e):Math.ceil(e)}function p(e){return e%2==0}n.r(t),n.d(t,{ceiledEven:()=>_,clamp:()=>i,defComparator:()=>d,equal:()=>l,greaterOrEqual:()=>c,greaterThan:()=>o,isBaseDecimal:()=>a,isEven:()=>p,lessThan:()=>s,log10:()=>u,max:()=>m,min:()=>h,sign:()=>r,toInt:()=>g})},303999:(e,t,n)=>{"use strict";n.d(t,{isTicksEnabled:()=>o});var s=n(638456);n(931924);function o(){return!(0,s.onWidget)()}},256225:(e,t,n)=>{n(778785).setClasses();var s=n(709903).whenDocumentReady,o=n(437861).handleTVLinksClick;s((()=>{o()}))},912465:(e,t,n)=>{"use strict";function s(e,t){const n=t||window.locale||"en";let s=e[n]?e[n]:e.en;return s="tradingview.com"===s?"www.tradingview.com":s,s?document.location.protocol+"//"+s:""}n.d(t,{determineBaseUrl:()=>s})},659923:(e,t,n)=>{"use strict";n.d(t,{showTooManyStudiesNotice:()=>i});var s=n(444372),o=n(779923);function i(e){(0,o.showWarning)({title:s.t(null,void 0,n(966719)),text:s.t(null,{replace:{number:`${e}`}},n(586146))})}},925049:(e,t,n)=>{"use strict";function s(){let e,t;return{promise:new Promise(((n,s)=>{e=n,t=s})),reject:t,resolve:e}}n.d(t,{createDeferredPromise:()=>s})},927435:(e,t,n)=>{"use strict";n.d(t,{prepareCurrencyValue:()=>o});var s=n(444372);function o(e){let t=[];const o=function(e){switch(e){case"PCT":return"%";case"PCTPAR":return s.t(null,{context:"_max_len_9"},n(46374));case"PCTGDP":return s.t(null,{context:"_max_len_9"},n(421685));default:return e}}(e.currency_code||e.value_unit_id||"");switch(e.measure){case"price":case"unit":t=[o,e.unit_id];break;default:t=[o]}return t.filter(Boolean).join(" / ")}},437861:(e,t,n)=>{"use strict";n.d(t,{handleTVLinksClick:()=>r,sendWidgetTrackData:()=>a});var s=n(439563),o=n(283834),i=n(974629);function r(){document.addEventListener("click",(e=>{const t=e.target.closest(":link");if(!t?.hostname||!(0,i.isInternalHost)(t.hostname,"tradingview.com"))return;const n=t.dataset.targetType||null;a(t.href,n)}))}function a(e,t){const n=function(){const e=window.initData.hashSettings;if(Object.keys(e).length>0)return(0,o.filterUtmInfo)(e)
;const t=new URLSearchParams(location.href);return{utm_campaign:t.get("utm_campaign")||void 0,utm_source:t.get("utm_source")||void 0}}(),i=function(e){const t=location.ancestorOrigins?.[0]||document.referrer;return e.utm_source||function(e){try{return new URL(e).host}catch(e){return""}}(t)}(n);!async function(e){(await(0,s.getEmbedWidgetTracker)())?.trackWidgetTVLinkClick(e)}({widget_type:c(n),domain:i,link:e,target_type:t})}function c(e){if(e.utm_campaign)return e.utm_campaign;const t=location.pathname;return t.includes("embed-widget")?t.split("/")[2]:t}},631013:(e,t,n)=>{"use strict";n.d(t,{trackWidgetLoadMetaInfo:()=>o});var s=n(439563);async function o(e){Math.random()>.005||(await(0,s.getEmbedWidgetTracker)())?.trackWidgetLoadMetaInfo(e)}},762553:(e,t,n)=>{"use strict";n.d(t,{extractWidgetSettings:()=>o});const s={whitelabel:!0,permissionOverrides:!0};function o(e,t=[],n){return function(e,t,n,o=[],i){const r=n.slice(1),a=decodeURIComponent(r);let c={};try{""!==a&&(c=JSON.parse(a),void 0!==i&&i(e,c),Object.keys(c).forEach((e=>{(s[e]||o.includes(e))&&delete c[e]})))}catch(e){c={},console.warn("Hash params parsing error! Hash params ignored.")}const l=t.slice(1),u=t.includes("%")?decodeURIComponent(l):t,d=new URLSearchParams(u);let h={};try{d.forEach(((e,t)=>{o.includes(t)||(h[t]=e)})),void 0!==i&&i(e,h)}catch(e){h={},console.warn("Search query params parsing error! Search query params ignored.")}return Object.assign({},e,c,h)}(e,location.search,location.hash,t,n)}},735566:(e,t,n)=>{"use strict";var s;n.r(t),n.d(t,{LOGLEVEL:()=>s,getLogHistory:()=>w,getLogLevel:()=>h,getLogger:()=>b,getRawLogHistory:()=>p,isHighRateEnabled:()=>m,loggingOff:()=>v,loggingOn:()=>C,serializeLogHistoryEntry:()=>f,setHighRateStatus:()=>g,setLogLevel:()=>_}),function(e){e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.NORMAL=4]="NORMAL",e[e.DEBUG=5]="DEBUG"}(s||(s={}));let o=0;const i=[];let r=null,a=null,c=null,l=null,u=s.WARNING,d=!1;function h(){return u}function m(){return d}function _(e){e=Math.max(s.ERROR,Math.min(s.DEBUG,e)),u=e}function g(e){d=e}function p(e,t){let n=i.reduce(((e,t)=>e.concat(t)),[]);return n.sort(((e,t)=>e.id-t.id)),void 0!==t&&(n=n.filter((e=>e.subSystemId===t))),"number"==typeof e&&(n=n.slice(-e)),n}function f(e){return new Date(e.timestamp).toISOString()+":"+e.subSystemId+":"+e.message.replace(/"/g,"'")}const w=(e,t)=>function(e,t){let n,s=0,o=0;for(n=e.length-1;n>=1&&(s+=8*(1+encodeURIComponent(e[n]).length),!(n-1>0&&(o=8*(1+encodeURIComponent(e[n-1]).length),s+o>t)));n--);return e.slice(n)}(p(e,t).map(f),75497472);function y(e,t,n,i){if(t===a&&i.id===c)return;const d=new Date;if(e<=s.NORMAL&&function(e,t,n,s,i){"function"==typeof structuredClone&&(t=structuredClone(t));const r={id:o,message:t,subSystemId:s,timestamp:Number(e)};o+=1,n.push(r),void 0!==i&&n.length>i&&n.splice(0,1)}(d,t,n,i.id,i.maxCount),e<=u&&(!i.highRate||m())&&(!r||i.id.match(r))){const n=d.toISOString()+":"+i.id+":"+t;switch(e){case s.DEBUG:console.debug(n);break;case s.INFO:case s.NORMAL:
i.color?console.log("%c"+n,"color: "+i.color):console.log(n);break;case s.WARNING:console.warn(n);break;case s.ERROR:console.error(n)}a=t,c=i.id,null!==l&&clearTimeout(l),l=setTimeout((()=>{a=null,c=null,l=null}),1e3)}}function b(e,t={}){const n=[];i.push(n);const o=Object.assign(t,{id:e});function r(e){return t=>y(e,String(t),n,o)}return{logDebug:r(s.DEBUG),logError:r(s.ERROR),logInfo:r(s.INFO),logNormal:r(s.NORMAL),logWarn:r(s.WARNING)}}const C=(e,t)=>{_(s.DEBUG),d=Boolean(e),r=t||null},v=()=>{_(s.INFO)}},23482:(e,t,n)=>{"use strict";n.d(t,{isAndroid:()=>m,isAnyMobile:()=>w,isBlackBerry:()=>_,isChrome:()=>a,isEdge:()=>l,isFF:()=>c,isIOS:()=>g,isIPad:()=>f,isLinux:()=>h,isMac:()=>d,isOperaMini:()=>p,isSafari:()=>u,mobiletouch:()=>i,touch:()=>r});const s="undefined"!=typeof window&&"undefined"!=typeof navigator,o=s&&"ontouchstart"in window,i=s&&o&&"onorientationchange"in window,r=s&&(o||!!navigator.maxTouchPoints),a=s&&window.chrome&&window.chrome.runtime,c=s&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,l=s&&/\sEdge\/\d\d\b/.test(navigator.userAgent),u=s&&Boolean(navigator.vendor)&&navigator.vendor.indexOf("Apple")>-1&&-1===navigator.userAgent.indexOf("CriOS")&&-1===navigator.userAgent.indexOf("FxiOS"),d=s&&/mac/i.test(navigator.platform),h=(s&&/Win32|Win64/i.test(navigator.platform),s&&/Linux/i.test(navigator.platform)),m=s&&/Android/i.test(navigator.userAgent),_=s&&/BlackBerry/i.test(navigator.userAgent),g=s&&/iPhone|iPad|iPod/.test(navigator.platform),p=s&&/Opera Mini/i.test(navigator.userAgent),f=s&&("MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||/iPad/.test(navigator.platform)),w=m||_||g||p}}]);